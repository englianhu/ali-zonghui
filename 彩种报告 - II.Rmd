---
title: "<span style='color:Red'>é˜¿é‡Œå½©ç¥¨</span>"
subtitle: "å½©ç§æŠ¥å‘Š (ç¬¬IIéƒ¨)"
author: "é›·æ¬§ <img src='æ–‡è‰ºåŠå›¾åº“/dashencaicai2.jpg' height='14'>"
date: "`r lubridate::today('Asia/Tokyo')`"
output:
  html_document: 
    mathjax: https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    code_folding: hide
    css: CSSBackgrounds.css
---

# ä¸»é¢˜

<img src='æ–‡è‰ºåŠå›¾åº“/å•†åœºå¦‚æˆ˜åœº.png' width='560'>

[[**ä¸»é¢˜æ›²**]{style="color:blue"}](https://github.com/englianhu/report/discussions)

ğŸš„ä¸œæ–¹å¿«è½¦ï¼ŒğŸš„ä¸€å¸¦ä¸€è·¯ã€‚

<audio controls loop autoplay src="æ–‡è‰ºåŠæ­Œæ›²åº“/æ±æ–¹å¿«è»Šåˆå”±åœ˜ Oriental Express - ç´…ç´…é’æ˜¥æ•²å‘€æ•² ã€Šé»‘æ¾æ²™å£«ã€‹å»£å‘Šä¸»é¡Œæ›².mp3" controls></audio>

<br>

# è®¾å®š

## SCSS è®¾ç½®

<style>
pre {
  overflow-x: auto;
}
pre code {
  word-wrap: normal;
  white-space: pre;
}
.table-hover > tbody > tr:hover { 
  background-color: #8D918D;
}
</style>

```{r load-sass, class.source='bg-success', class.output='bg-primary'}
# install.packages('remotes', dependencies = TRUE, INSTALL_opts = '--no-lock')
library('BBmisc', 'rmsfuns')
#remotes::install_github("rstudio/sass")
lib('sass')

## https://support.rstudio.com/hc/en-us/articles/200532197
## https://community.rstudio.com/t/r-does-not-display-korean-chinese/30889/3?u=englianhu
#Sys.setlocale("LC_CTYPE", "en_US.UTF-8")
#Sys.setlocale("LC_CTYPE", "zh_CN.UTF-8")
#Sys.setlocale(category = "LC_CTYPE", "Chinese (Simplified)_China.936")
#Sys.setlocale(locale = "Chinese")
#Sys.setlocale(locale = "Japanese")
#Sys.setlocale(locale = "English")

# rmarkdown::render('/home/englianhu/Documents/owner/ryo-cn.Rmd',  encoding = 'UTF-8')
#Sys.setlocale("LC_CTYPE", "UTF-8")
#Sys.setlocale(locale = "UTF-8")
#Sys.setlocale(category = "LC_ALL", locale = "chs")
#Sys.setlocale(category = "LC_ALL", locale = "UTF-8")
#Sys.setlocale(category = "LC_ALL", locale = "Chinese")
#Sys.setlocale(category = "LC_ALL", locale = "zh_CN.UTF-8")
Sys.setlocale("LC_ALL", "en_US.UTF-8")
```

```{scss set-scss, class.source='bg-success', class.output='bg-primary'}
/* https://stackoverflow.com/a/66029010/3806250 */
h1 { color: #002C54; }
h2 { color: #2F496E; }
h3 { color: #375E97; }
h4 { color: #556DAC; }
h5 { color: #92AAC7; }

/* ----------------------------------------------------------------- */
/* https://gist.github.com/himynameisdave/c7a7ed14500d29e58149#file-broken-gradient-animation-less */
.hover01 {
  /* color: #FFD64D; */
  background: linear-gradient(155deg, #EDAE01 0%, #FFEB94 100%);
  transition: all 0.45s;
  &:hover{
    background: linear-gradient(155deg, #EDAE01 20%, #FFEB94 80%);
    }
  }

.hover02 {
  color: #FFD64D;
  background: linear-gradient(155deg, #002C54 0%, #4CB5F5 100%);
  transition: all 0.45s;
  &:hover{
    background: linear-gradient(155deg, #002C54 20%, #4CB5F5 80%);
    }
  }

.hover03 {
  color: #FFD64D;
  background: linear-gradient(155deg, #A10115 0%, #FF3C5C 100%);
  transition: all 0.45s;
  &:hover{
    background: linear-gradient(155deg, #A10115 20%, #FF3C5C 80%);
    }
  }
```

```{r gb-opts, class.source='hover01', class.output='hover02'}
## Set the timezone but not change the datetime
Sys.setenv(TZ = 'Asia/Shanghai')

## Setting to omit all warnings
## https://stackoverflow.com/a/36846793/3806250
## Set width
## options(knitr.table.format = 'html') will set all kableExtra tables to be 'html', otherwise need to set the parameter on every single table.
options(warn = -1, width = 999, knitr.table.format = 'html')#, digits.secs = 6)

## https://stackoverflow.com/questions/39417003/long-vectors-not-supported-yet-abnor-in-rmd-but-not-in-r-script
## https://yihui.org/knitr/options
knitr::opts_chunk$set(
  class.source = 'hover01', class.output = 'hover02', class.error = 'hover03', 
  message = FALSE, warning = FALSE, error = TRUE, 
  autodep = TRUE, aniopts = 'loop', 
  progress = TRUE, verbose = TRUE, 
  cache = FALSE, cache.lazy = FALSE, result = 'asis')
```

<br><br>

## è®¾ç½®

```{r libs, eval=FALSE}
## Setup Options, Loading Required Libraries and Preparing Environment
## Loading the packages and setting adjustment
source('å‡½æ•°/libs.R')
```

è¯»å–ç¨‹åºåŒ…

```{r load-pkgs}
## Setup Options, Loading Required Libraries and Preparing Environment
## 3210448065@qq.com
## leiou123

## 2849108450@qq.com
## leiou123
## https://rstudio.cloud/project/1198888

## Loading the package 'BBmisc'
if(suppressMessages(!require('BBmisc'))){
  install.packages('BBmisc', dependencies = TRUE, INSTALL_opts = '--no-lock')
  suppressMessages(library('BBmisc'))
}
if (suppressMessages(!require('rmsfuns'))) {
  install.packages('rmsfuns', dependencies = TRUE, INSTALL_opts = '--no-lock')
  suppressMessages(library('rmsfuns'))
}

if(!require('REmap')) devtools::install_github('lchiffon/REmap')

## Loading multiple packages at once
#pkgs <- c('readr', 'plyr', 'dplyr', 'magrittr', 'tidyverse', 'devtools', 'zoo', 'lubridate', 'stringr', 'rvest', 'markdown', 'googleVis', 'knitr', 'rmarkdown', 'htmltools', 'knitr', 'kableExtra', 'formattable', 'echarts4r', 'radarchart', 'MASS', 'htmlwidgets', 'maps', 'REmap', 'ggmap', 'vembedr')

pkgs <- c('plyr', 'dplyr', 'magrittr', 'stringr', 'knitr', 'kableExtra', 'lubridate', 'broom', 'purrr', 'readxl', 'tibble', 'DT')

suppressAll(lib(pkgs))
load_pkg(pkgs)
rm(pkgs)

## Set the googleVis options first to change the behaviour of plot.gvis, so that 
##  only the chart component of the HTML file is written into the output file.
op <- options(gvis.plot.tag = 'chart')

## <audio src='music/bigmoney.mp3' autoplay controls loop></audio>
```

```{r set-prefer}
conflict_prefer('filter', 'dplyr')
conflict_prefer('select', 'dplyr')
conflict_prefer('mutate', 'dplyr')
conflict_prefer('rename', 'dplyr')
```

<br><br>

# ç®€ä»‹

å½“åˆåœ¨æ¨å¹¿éƒ¨é—¨ï¼Œ**å®‹ç¥–ï¼šå®‹ç»„é•¿**ç»™ä¸ªæ ·æœ¬æ•°æ®ï¼Œæˆ‘å°±å°è¯•ä½¿ç”¨çº¿æ€§æ¨¡å‹å’Œæ—¶é—´åºåˆ—`arima`æ¨¡å‹åˆ†æäº†è¿›ç²‰ä¸šç»©ï¼Œè¯¦æƒ…è¯·å‚è€ƒ[é˜¿é‡Œå½©ç¥¨ - åˆ†ææ ·æœ¬æ•°æ®](https://rpubs.com/englianhu/ali)^[åŸºäºæ•°æ®è§‚æµ‹å€¼å¤ªå°‘^[[binary.com Interview Question I (Extention)](https://rpubs.com/englianhu/binary-Q1E)å°è¯•åˆ†åˆ«ä½¿ç”¨`3ä¸ªæœˆ`ã€`6ä¸ªæœˆ`ã€`12ä¸ªæœˆ`ã€`18ä¸ªæœˆ`å’Œ`24ä¸ªæœˆ`çš„æ•°æ®ï¼Œç»“æœ`12ä¸ªæœˆ`çš„æ•°æ®æœ€ä¸ºç²¾å‡†ã€‚]ï¼Œæ‰€ä»¥æš‚æ—¶æ²¡æœ‰é¢„æµ‹ã€‚]ã€‚ç„¶åè½¬åˆ°è¿ç»´éƒ¨é—¨åˆ†æäº†[é˜¿é‡Œå½©ç¥¨ - å½©ç§æŠ¥å‘Š](https://rpubs.com/englianhu/ali_bet_type)ï¼Œåªæ˜¯åŸºæœ¬åˆ†æå½©ç§ï¼Œå°†æ•°æ®è§†è§‰åŒ–ï¼›æ­¤å•†ä¸šåˆ†æè¿›ä¸€æ­¥ä½¿ç”¨æ··åˆçº¿æ€§æ¨¡å‹åˆ†ææ•°æ®ï¼Œé¢„æµ‹å½©ç§ç›ˆåˆ©ã€‚

<br>
<br>

# æ•°æ®

<br>

è¯»å–æ ·æœ¬æ•°æ®ã€‚

```{r, results = 'asis', warning = FALSE}
## è¯»å–æ•°æ®
fls <- suppressWarnings(list.files('æ–‡è‰ºæ•°æ®åº“/å½©ç§'))
smp <- fls %>% 
  llply(., function(x) {
    dtt <- x %>% str_replace_all('.xls', '') %>% ymd
    smpp <- read_excel(paste0('æ–‡è‰ºæ•°æ®åº“/å½©ç§/', x)) %>% 
      .[-nrow(.),]
    data.frame('æ—¥æœŸ' = dtt, smpp)
  }) %>% bind_rows %>% 
    as_tibble %>% 
    mutate('å½©ç§åç§°' = factor(å½©ç§åç§°), 'ç›ˆç‡' = as.numeric(percent(ç›ˆç‡))) %>% 
    mutate_if(is.character, as.numeric)
rm(fls)

nm <- names(smp)
names(smp) <- c('Date', 'Type', 'Bettor', 'Turnover', 'Won', 'Cancelled', 'Rebates', 'Profit', 'Profit_rate')

## è½¬åŒ–ä¸ºå¤§æ•°æ®
smp2 <- smp
#smp2 <- copy_to(sc, smp2)

# smp2 %>% 
#   as_tibble %>% 
#   kbl('html', caption = 'æ¯æ—¥æŠ•æ³¨äººæ•°', escape = F) %>% 
#   kable_styling(
#     bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
#   scroll_box(height = '400px')
```

```{r}
smp %>% glimpse
```

<span style='color:Orange'>*å›¾è¡¨2.1ï¼šæ•°æ®ç®€ä»‹*</span>

<s>ä¸Šå›¾</s>[é˜¿é‡Œå½©ç¥¨ - å½©ç§æŠ¥å‘Š](https://rpubs.com/englianhu/ali_bet_type)æ˜¾ç¤ºä»`r smp$Date %>% range %>% .[1]`åˆ°`r smp$Date %>% range %>% .[2]`çš„æŠ¥è¡¨æ•°æ®ï¼Œä¸€å…±æœ‰`r nrow(smp2)`ä¸ªè§‚æµ‹å€¼ã€‚

<br>
<br>

# ç»Ÿè®¡æ¨¡å‹

<br>

## å¤šå…ƒç›¸äº’å¼æ¨¡å‹

<br>

ä»¥ä¸‹æ•°æ®æ˜¾ç¤ºæ¯æ—¥æŠ•æ³¨äººæ•°ã€‚

```{r, results = 'asis', warning = FALSE}
# smp2 %>%
#     spark_apply(
#         function(e) summary(lm(Profit ~ Turnover * Bettor * Won, e))$r.squared,
#         names = 'r.squared',
#         group_by = 'Type')

# æ¯æ—¥è§‚æµ‹å€¼
smp2 %>% 
    ddply(.(Date), nrow) %>% 
    as_tibble %>% dplyr::rename(n = V1) %>% 
  ## https://www.colorhexa.com/color-names
  mutate(n = color_tile('#007fff', 'white')(n)) %>% #azure
  kbl('html', caption = 'æ¯æ—¥æŠ•æ³¨äººæ•°', escape = F, align = 'c') %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  scroll_box(height = '400px')
```

<span style='color:Orange'>*å›¾è¡¨3.1.1ï¼šæ¯æ—¥è§‚æµ‹å€¼*</span>

<br>

æˆ‘ä¸æ™“å¾—æœ€ä¼˜æ¨¡å‹ï¼Œå…ˆä»¥å®Œæ•´æ•°æ®è§‚æµ‹å€¼ä¸ºæ ‡å‡†ï¼Œä»¥ä¸‹ä¹ƒ`å¤šå…ƒç›¸äº’å¼æ¨¡å‹`^[[å¦‚ä½• Estimate linear models](https://d.cosx.org/d/419820-estimate-linear-models/7)ä¸­çš„[UNDERSTANDING 3-WAY INTERACTIONS BETWEEN CONTINUOUS VARIABLES](https://tomhouslay.com/2014/03/21/understanding-3-way-interactions-between-continuous-variables/#comment-63365)]ã€‚

$$
\begin{align*}
 Y& = \beta_{0} + \beta_{1}X_{1} + \beta_{2}X_{2} + \beta_{3}X_{1}X_{2}\\ 
 &= \beta_{0} + {\color{Red} \widetilde{\beta_{1}}}X_{1} + \beta_{2}X_{2}; 
 {\color{Red} \widetilde{\beta_{1}}} = \beta_{1} + \beta_{2}X_{2}\\
\end{align*}
$$
<span style='color:Orange'>*æ–¹ç¨‹3.1.1ï¼šå¤šå…ƒç›¸äº’å¼æ¨¡å‹*ï¼ˆ[*åœ¨çº¿LaTEXæ–¹ç¨‹ç¼–è¾‘å™¨*](https://www.codecogs.com/latex/eqneditor.php)ï¼‰</span>

```{r, results = 'asis', eval = FALSE, warning = FALSE}
# lm1 <- lm(Profit ~ Type * Bettor * Turnover * Won * Cancelled * Rebates, smp2)

# m.aic.backward1 <- step(lm1, direction = 'backward', trace = 1)
# m.aic.backward2 <- step(lm1)

md <- list(
  m00 = lm(Profit ~ Date * Type * Bettor * Turnover * Won * Cancelled * Rebates, smp2) %>% extractAIC, 
  m01 = lm(Profit ~ Type * Bettor * Turnover * Won * Cancelled * Rebates, smp2) %>% extractAIC, 
  m02 = lm(Profit ~ Type * Bettor * Turnover * Won * Cancelled, smp2) %>% extractAIC, 
  m03 = lm(Profit ~ Type * Bettor * Turnover * Won * Rebates, smp2) %>% extractAIC, 
  m04 = lm(Profit ~ Type * Bettor * Turnover * Cancelled * Rebates, smp2) %>% extractAIC, 
  m05 = lm(Profit ~ Type * Bettor * Won * Cancelled * Rebates, smp2) %>% extractAIC, 
  m06 = lm(Profit ~ Type * Turnover * Won * Cancelled * Rebates, smp2) %>% extractAIC, 
  m07 = lm(Profit ~ Bettor * Turnover * Won * Cancelled * Rebates, smp2) %>% extractAIC, 
  m08 = lm(Profit ~ Type * Bettor * Turnover * Won, smp2) %>% extractAIC, 
  m09 = lm(Profit ~ Type * Bettor * Turnover * Rebates, smp2) %>% extractAIC, 
  m10 = lm(Profit ~ Type * Won * Cancelled * Rebates, smp2) %>% extractAIC, 
  m11 = lm(Profit ~ Type * Bettor * Turnover * Cancelled, smp2) %>% extractAIC, 
  m12 = lm(Profit ~ Type * Bettor * Won * Rebates, smp2) %>% extractAIC, 
  m13 = lm(Profit ~ Type * Bettor * Won * Cancelled, smp2) %>% extractAIC, 
  m14 = lm(Profit ~ Type * Turnover * Won * Rebates, smp2) %>% extractAIC, 
  m15 = lm(Profit ~ Type * Turnover * Cancelled * Rebates, smp2) %>% extractAIC, 
  m16 = lm(Profit ~ Type * Turnover * Won * Rebates, smp2) %>% extractAIC, 
  m17 = lm(Profit ~ Type * Won * Cancelled * Rebates, smp2) %>% extractAIC, 
  m18 = lm(Profit ~ Bettor * Turnover * Won * Cancelled, smp2) %>% extractAIC, 
  m19 = lm(Profit ~ Bettor * Turnover * Won * Rebates, smp2) %>% extractAIC, 
  m20 = lm(Profit ~ Bettor * Turnover * Cancelled * Rebates, smp2) %>% extractAIC, 
  m21 = lm(Profit ~ Type * Bettor * Turnover * Won * Cancelled * Rebates, smp2) %>% extractAIC, 
  m22 = lm(Profit ~ Turnover * Won * Cancelled * Rebates, smp2) %>% extractAIC) %>% 
  ldply %>% 
  as_tibble %>% 
  dplyr::rename(df = V1, AIC = V2)

## save files, easier to read.
microbenchmark(
   save(md, file = 'æ–‡è‰ºæ•°æ®åº“/md.rda'), 
   write_rds(md, 'æ–‡è‰ºæ•°æ®åº“/md.rds'), 
   saveRDS(md, file = 'æ–‡è‰ºæ•°æ®åº“/md.rds'))
#Unit: microseconds
#                                expr     min       lq     mean   median      uq     max neval
#      save(md, "æ–‡è‰ºæ•°æ®åº“/md.rda") 114.666 130.9080 135.2061 134.3990 137.111 174.759   100
# write_rds(md, "æ–‡è‰ºæ•°æ®åº“/md.rds") 111.098 120.6370 126.8601 125.1935 129.534 178.582   100
#   saveRDS(md, "æ–‡è‰ºæ•°æ®åº“/md.rds") 143.649 160.3135 178.6935 183.2730 186.673 358.803   100
```

1) $m00 = lm(Profit \sim Date * Type * Bettor * Turnover * Won * Cancelled * Rebates, smp2)$
2) $m01 = lm(Profit \sim Type * Bettor * Turnover * Won * Cancelled * Rebates, smp2)$
3) $m02 = lm(Profit \sim Type * Bettor * Turnover * Won * Cancelled, smp2)$
4) $m03 = lm(Profit \sim Type * Bettor * Turnover * Won * Rebates, smp2)$
5) $m04 = lm(Profit \sim Type * Bettor * Turnover * Cancelled * Rebates, smp2)$
6) $m05 = lm(Profit \sim Type * Bettor * Won * Cancelled * Rebates, smp2)$
7) $m06 = lm(Profit \sim Type * Turnover * Won * Cancelled * Rebates, smp2)$
8) $m07 = lm(Profit \sim Bettor * Turnover * Won * Cancelled * Rebates, smp2)$
9) $m08 = lm(Profit \sim Type * Bettor * Turnover * Won, smp2)$
10) $m09 = lm(Profit \sim Type * Bettor * Turnover * Rebates, smp2)$
11) $m10 = lm(Profit \sim Type * Won * Cancelled * Rebates, smp2)$
12) $m11 = lm(Profit \sim Type * Bettor * Turnover * Cancelled, smp2)$
13) $m12 = lm(Profit \sim Type * Bettor * Won * Rebates, smp2)$
14) $m13 = lm(Profit \sim Type * Bettor * Won * Cancelled, smp2)$
15) $m14 = lm(Profit \sim Type * Turnover * Won * Rebates, smp2)$
16) $m15 = lm(Profit \sim Type * Turnover * Cancelled * Rebates, smp2)$
17) $m16 = lm(Profit \sim Type * Turnover * Won * Rebates, smp2)$
18) $m17 = lm(Profit \sim Type * Won * Cancelled * Rebates, smp2)$
19) $m18 = lm(Profit \sim Bettor * Turnover * Won * Cancelled, smp2)$
20) $m19 = lm(Profit \sim Bettor * Turnover * Won * Rebates, smp2)$
21) $m20 = lm(Profit \sim Bettor * Turnover * Cancelled * Rebates, smp2)$
22) $m21 = lm(Profit \sim Type * Bettor * Turnover * Won * Cancelled * Rebates, smp2)$
23) $m22 = lm(Profit \sim Turnover * Won * Cancelled * Rebates, smp2)$

<span style='color:Orange'>*æ–¹ç¨‹3.1ï¼šå¤šå…ƒç›¸äº’å¼æ¨¡å‹*</span>

ä»¥ä¸Šæ¨¡å‹ä½¿ç”¨$lm()$å‡½æ•°ï¼Œä»æ¨¡å‹$m00 \sim m22$ï¼Œ[How to Make Beautiful Tables in R](https://rfortherestofus.com/2019/11/how-to-make-beautiful-tables-in-r/)æœ‰å¾ˆå¤šæ¡Œè¡¨ç¨‹åºåŒ…ï¼Œä»¥ä¸‹å’±ä»¬æ¯”è¾ƒä¸‹**æœ€ä¼˜æ¨¡å‹**ã€‚

<br>

### formattable

<br>

```{r, results = 'asis', warning = FALSE}
md <- read_rds('æ–‡è‰ºæ•°æ®åº“/md.rds')
md2 <- md

## https://www.colorhexa.com/color-names
md2 %>% 
  formattable(
    list(
        AIC = formatter('span', style = x ~ formattable::style(
            color = ifelse(rank(x) <= 3, 'darkgoldenrod', 'grey')), 
            x ~ paste0(round(x, 2), 
                       ' (rank: ', sprintf('%1.f', rank(x)), ')')))) %>% 
    mutate(df = color_tile('#2a52be', 'white')(df)) #colbalt
```

<span style='color:Orange'>*æ–¹ç¨‹3.1.1ï¼šæœ€ä¼˜å¤šå…ƒç›¸äº’å¼æ¨¡å‹AICæ¯”è¾ƒ*</span>

<br>

### kableExtra

<br>

```{r, results = 'asis', warning = FALSE}
## https://www.colorhexa.com/color-names
md2 %>% 
  mutate(
    df = color_tile('#2a52be', 'white')(df), #colbalt
    AIC = ifelse(
      rank(AIC) <= 3, 
      cell_spec(
        paste0(round(AIC, 2), ' (rank: ', sprintf('%1.f', rank(AIC)), ')'), 
        'html', color = 'darkgoldenrod', bold = T), 
      cell_spec(
        paste0(round(AIC, 2), ' (rank: ', sprintf('%1.f', rank(AIC)), ')'), 
        'html', color = 'grey', italic = T))) %>% 
  kbl('html', caption = 'æœ€ä¼˜æ¨¡å‹', escape = F, align = c('c', 'r', 'r')) %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  kable_material() %>% 
  scroll_box(height = '400px')
```

<span style='color:Orange'>*æ–¹ç¨‹3.1.2ï¼šæœ€ä¼˜å¤šå…ƒç›¸äº’å¼æ¨¡å‹AICæ¯”è¾ƒ*</span>

<br>

ä»¥ä¸‹æ¨¡å‹ä¹ƒå‰ä¸‰æ¦œï¼Œåˆ†åˆ«æ˜¯$m00$æ‰€æœ‰å› ç´ ï¼ŒåŒ…æ‹¬æ—¶é—´åºåˆ—å‚æ•°å› ç´ ï¼›$m07$å¿½ç•¥å½©ç§å› ç´ ï¼›$m22$åªåŒ…æ‹¬`æŠ•æ³¨é‡‘é¢`ã€`ä¸­å¥–é‡‘é¢`ã€`æ’¤å•é‡‘é¢`å’Œ`è¿”ç‚¹é‡‘é¢`å› ç´ ã€‚

1) $m00 = lm(Profit \sim Date * Type * Bettor * Turnover * Won * Cancelled * Rebates, smp2)$
8) $m07 = lm(Profit \sim Bettor * Turnover * Won * Cancelled * Rebates, smp2)$
23) $m22 = lm(Profit \sim Turnover * Won * Cancelled * Rebates, smp2)$

<span style='color:Orange'>*æ–¹ç¨‹3.2.1ï¼šå¤šå…ƒç›¸äº’å¼æ¨¡å‹*</span>

<span style='color:Red'>**å¤‡æ³¨**ï¼šä»¥ä¸Šæœ€ä¼˜æ¨¡å‹åŠ å…¥æ—¶é—´å˜é‡ï¼Œä¸è¿‡ä¹‹åç« èŠ‚çš„æ—¶é—´åºåˆ—æ¨¡å‹ï¼Œä¹Ÿå¾—ä¸ªåˆ«åˆ†æ**$m00$**å’Œ**$m07$**ï¼Œå› ä¸ºå·²ç»æŠŠæ—¶é—´å˜é‡åŠ å…¥åˆ†æï¼Œå†åŠ ä¸Šæ—¶é—´åºåˆ—çš„è¯ï¼Œä¸æ™“å¾—æ˜¯å¦å˜è´¨å‘¢ï¼Ÿ</span>

<br>
<br>

## å¤šå…ƒå¤šé¡¹å¼æ¨¡å‹

<br>

### å¤šå…ƒæ­£äº¤ä¸åŸå§‹å¤šé¡¹å¼æ¨¡å‹

<br>

#### å¤šå…ƒå¤šé¡¹å¼åŸºæœ¬æ¨¡å‹

<br>

- [å…³äºrï¼šæ‹Ÿåˆç”±`leaps :: regsubsets`é€‰æ‹©çš„å¤šé¡¹å¼å›å½’æ¨¡å‹](https://www.codenong.com/51223897)æœ‰ä¸¾ä¾‹ï¼Œè¿˜ä»‹ç»äº†`leaps`ç¨‹åºåŒ…ã€‚
- [lm()ä¸­çš„poly(): rawå’Œæ­£äº¤ä¹‹é–“çš„å·®ç•°](https://www.itdaan.com/tw/c0fe14f3fda89205497a506bf9e9c119)
- [Rå®ç°Polynomial regression](https://www.jianshu.com/p/8e6cc12d3036)
- [å¤šé¡¹å¼å›å½’ï¼ˆPolynomial regressionï¼‰åŠçº¿æ€§æ£€éªŒ](https://www.bioinfo-scrounger.com/archives/polynomial-regression)
- [How to interpret coefficients from a polynomial model fit?](https://stats.stackexchange.com/a/95952/68357)
- [poly() in lm(): difference between raw vs. orthogonal](https://stackoverflow.com/a/30000214/3806250)
- [Fitting Polynomial Regression in R](https://www.r-bloggers.com/2015/09/fitting-polynomial-regression-in-r)^[Section**How to fit a polynomial regression** in [Fitting Polynomial Regression in R](https://www.r-bloggers.com/2015/09/fitting-polynomial-regression-in-r) ]
- [Raw or orthogonal polynomial regression?](https://stats.stackexchange.com/questions/258307/raw-or-orthogonal-polynomial-regression)
- [Multivariate polynomials in R (`polynom` package)](https://cran.r-project.org/web/packages/multipol/vignettes/multipol.pdf)^[[Multivariate polynomials in R (`polynom` package)](https://cran.r-project.org/web/packages/multipol/vignettes/multipol.pdf)å¯ä¾›Rä½¿ç”¨è€…ä½¿ç”¨å¤šå…ƒéçº¿æ€§æ¨¡å‹]
- [Multivariate Polynomial Regression in R (Prediction)](https://stackoverflow.com/a/50261058/3806250)
- [Polynomial regression with multiple independent variables in R](https://stackoverflow.com/questions/45013550/polynomial-regression-with-multiple-independent-variables-in-r)

![<span style='color:Orange'>*å›¾åƒ3.2.1ï¼šå¤šé¡¹å¼çº¿å‹æ¨¡å‹*</span> [*Fitting Polynomial Regression in R*](https://www.r-bloggers.com/2015/09/fitting-polynomial-regression-in-r)](æ–‡è‰ºåŠå›¾åº“/How to fit a polynomial regression 2.png)

<span style='color:Red'>**å¤‡æ³¨**ï¼š[lm() breaks when using poly() with predictors set up as factors](https://stackoverflow.com/a/61410867/3806250)è®²è¿°`poly`æ— æ³•åˆ†æå¤šå…ƒ`factor`è€Œåªèƒ½åˆ†æè™šæ‹Ÿå˜é‡ï¼ˆ0æˆ–1ï¼‰ã€‚</span>

$$
Y = \beta_{0} + \beta_{1}X_{1} + \beta_{11}X^{2} + \beta_{111}X^{3}
$$

<span style='color:Orange'>*æ–¹ç¨‹3.1.2ï¼šå¤šå…ƒå¤šé¡¹å¼çº¿å‹æ¨¡å‹*</span>

<br>

##### å¤šå…ƒå¤šé¡¹ç›¸äº’å¼æ­£äº¤æ¨¡å‹

<br>

```{r, results = 'asis', eval = FALSE, warning = FALSE}
## https://stackoverflow.com/a/24133767/3806250
num <- 2:5

mprf_list <- llply(num, function(i) {
    mprf = list(
        #p00 = lm(Profit ~ 
        #         poly(Date, degree = i, raw = FALSE) * 
        #         poly(Bettor, degree = i, raw = FALSE) * 
        #         poly(Turnover, degree = i, raw = FALSE) * 
        #         poly(Won, degree = i, raw = FALSE) * 
        #         poly(Cancelled, degree = i, raw = FALSE) * 
        #         poly(Rebates, degree = i, raw = FALSE), smp2) %>% extractAIC, 
        {p01 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p01'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p01, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p01.rds'))}, 
        {p02 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p02'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p02, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p02.rds'))}, 
        {p03 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p03'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p03, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p03.rds'))}, 
        {p04 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p04'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p04, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p04.rds'))}, 
        {p05 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p05'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p05, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p05.rds'))}, 
        {p06 = lm(Profit ~ 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p06'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p06, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p06.rds'))}, 
        {p07 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p07'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p07, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p07.rds'))}, 
        {p08 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p08'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p08, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p08.rds'))}, 
        {p09 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p09'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p09, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p09.rds'))}, 
        {p10 = lm(Profit ~ 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p10'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p10, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p10.rds'))}, 
        {p11 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p11'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p11, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p11.rds'))}, 
        {p12 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p12'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p12, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p12.rds'))}, 
        {p13 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p13'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p13, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p13.rds'))}, 
        {p14 = lm(Profit ~ 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p14'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p14, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p14.rds'))}, 
        {p15 = lm(Profit ~ 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p15'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p15, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p15.rds'))}, 
        {p16 = lm(Profit ~ 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p16'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p16, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p16.rds'))}, 
        {p17 = lm(Profit ~ 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p17'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p17, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p17.rds'))}, 
        {p18 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p18'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p18, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p18.rds'))}, 
        {p19 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p19'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p19, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p19.rds'))}, 
        {p20 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p20'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p20, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p20.rds'))}, 
        {p21 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = FALSE) * 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p21'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p21, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p21.rds'))}, 
        {p22 = lm(Profit ~ 
                     poly(Turnover, degree = i, raw = FALSE) * 
                     poly(Won, degree = i, raw = FALSE) * 
                     poly(Cancelled, degree = i, raw = FALSE) * 
                     poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprf_p22'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p22, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p22.rds'))}
    ) %>% 
        ldply %>% 
        as_tibble
    
    ## save files, easier to read.
    #write_rds(mprf, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '.rds'))
})
```

<br>

##### å¤šå…ƒå¤šé¡¹ç›¸äº’å¼åŸå§‹æ¨¡å‹

<br>

```{r, results = 'asis', eval = FALSE, warning = FALSE}
## https://stackoverflow.com/a/24133767/3806250
num <- 2:5

mprt_list <- llply(num, function(i) {
    mprt = list(
        #p00 = lm(Profit ~ 
        #         poly(Date, degree = i, raw = TRUE) * 
        #         poly(Bettor, degree = i, raw = TRUE) * 
        #         poly(Turnover, degree = i, raw = TRUE) * 
        #         poly(Won, degree = i, raw = TRUE) * 
        #         poly(Cancelled, degree = i, raw = TRUE) * 
        #         poly(Rebates, degree = i, raw = TRUE), smp2) %>% extractAIC, 
        {p01 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p01'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p01, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p01.rds'))}, 
        {p02 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p02'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p02, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p02.rds'))}, 
        {p03 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p03'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p03, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p03.rds'))}, 
        {p04 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p04'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p04, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p04.rds'))}, 
        {p05 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p05'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p05, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p05.rds'))}, 
        {p06 = lm(Profit ~ 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p06'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p06, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p06.rds'))}, 
        {p07 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p07'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p07, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p07.rds'))}, 
        {p08 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p08'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p08, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p08.rds'))}, 
        {p09 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p09'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p09, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p09.rds'))}, 
        {p10 = lm(Profit ~ 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p10'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p10, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p10.rds'))}, 
        {p11 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p11'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p11, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p11.rds'))}, 
        {p12 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p12'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p12, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p12.rds'))}, 
        {p13 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p13'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p13, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p13.rds'))}, 
        {p14 = lm(Profit ~ 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p14'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p14, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p14.rds'))}, 
        {p15 = lm(Profit ~ 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p15'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p15, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p15.rds'))}, 
        {p16 = lm(Profit ~ 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p16'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p16, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p16.rds'))}, 
        {p17 = lm(Profit ~ 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p17'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p17, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p17.rds'))}, 
        {p18 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p18'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p18, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p18.rds'))}, 
        {p19 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p19'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p19, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p19.rds'))}, 
        {p20 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p20'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p20, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p20.rds'))}, 
        {p21 = lm(Profit ~ 
                     poly(Bettor, degree = i, raw = TRUE) * 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p21'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p21, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p21.rds'))}, 
        {p22 = lm(Profit ~ 
                     poly(Turnover, degree = i, raw = TRUE) * 
                     poly(Won, degree = i, raw = TRUE) * 
                     poly(Cancelled, degree = i, raw = TRUE) * 
                     poly(Rebates, degree = i, raw = TRUE), smp2) %>% 
          extractAIC %>% 
          as_tibble %>% 
          t %>% as_tibble %>% 
          dplyr::rename(df = V1, AIC = V2) %>% 
          mutate(.md = paste0('mprt_p22'), degree = i, raw = TRUE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p22, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '_p22.rds'))}
    ) %>% 
        ldply %>% 
        as_tibble
    
    ## save files, easier to read.
    #write_rds(mprt, paste0('æ–‡è‰ºæ•°æ®åº“/mprt', i, '.rds'))
})
```

<br>

#### å¤šå…ƒå¤šé¡¹ç›¸äº’å¼ç¨‹åº¦æœ€ä¼˜åŒ–

ä»¥ä¸‹æ–‡ç« èŠåŠå¤šå…ƒå¤šé¡¹ç›¸äº’å¼çº¿å‹æ¨¡å‹ç¨‹åº¦æœ€ä¼˜åŒ–ã€‚

```
To get a third order polynomial in x (x^3), you can do

lm(y ~ x + I(x^2) + I(x^3))
or

lm(y ~ poly(x, 3, raw=TRUE))
You could fit a 10th order polynomial and get a near-perfect fit, but should you?

EDIT: poly(x, 3) is probably a better choice (see @hadley below).
```

*å‡ºå¤„ï¼š*[*Fitting polynomial model to data in R*](https://stackoverflow.com/a/3822706/3806250)

```
But what I want to say is that a polynomial of more than 3-5 degree is never useful! The critical reason is the Runge's phenomenon. In terms of statistical terminology: a high-order polynomial always badly overfits data!. Don't naively think that because orthogonal polynomials are numerically more stable than raw polynomials, Runge's effect can be eliminated. No, a polynomial of degree k forms a vector space, so whatever basis you use for representation, they have the same span!
```

*å‡ºå¤„ï¼š*[*High (or very high) order polynomial regression in R (or alternatives?)*](https://stackoverflow.com/a/39803843/3806250)

```
Deciding on a degree
In performing a polynomial regression we must decide on the degree of the polynomial to use. One way to do this is by using hypothesis tests. We now fit models ranging from linear to a degree-5 polynomial and seek to determine the simplest model which is sufficient to explain the relationship between wage and age.

We can do this using the anova() function, which performs an analysis of variance (ANOVA, using an F-test) in order to test the null hypothesis that a model  M1  is sufficient to explain the data against the alternative hypothesis that a more complex model  M2  is required. In order to use the anova() function,  M1  and  M2  must be nested models: the predictors in  M1  must be a subset of the predictors in  M2 . In this case, we fit five different models and sequentially compare the simpler model to the more complex model:

fit_1 = lm(wage~age, data = Wage)
fit_2 = lm(wage~poly(age,2), data = Wage)
fit_3 = lm(wage~poly(age,3), data = Wage)
fit_4 = lm(wage~poly(age,4), data = Wage)
fit_5 = lm(wage~poly(age,5), data = Wage)
print(anova(fit_1,fit_2,fit_3,fit_4,fit_5))
```
[*7.8.1 Polynomial Regression and Step Functions7.8.1 Polynomial Regression and Step Functions*](http://www.science.smith.edu/~jcrouser/SDS293/labs/lab12-r.html#Deciding-on-a-degree)

![<span style='color:Orange'>*å›¾åƒ3.2.2aï¼šåˆ†å±‚å¤šé¡¹å¼çº¿å‹æ¨¡å‹*</span> [*High (or very high) order polynomial regression in R (or alternatives?)*](https://stackoverflow.com/a/39803843/3806250)](æ–‡è‰ºåŠå›¾åº“/polynomials and orthogonal polymials.png)

![<span style='color:Orange'>*å›¾åƒ3.2.2bï¼šåˆ†å±‚å¤šé¡¹å¼çº¿å‹æ¨¡å‹*</span> [*High (or very high) order polynomial regression in R (or alternatives?)*](https://stackoverflow.com/a/39803843/3806250)](æ–‡è‰ºåŠå›¾åº“/polynomials and orthogonal polymials 2.png)

![<span style='color:Orange'>*å›¾åƒ3.2.2cï¼šåˆ†å±‚å¤šé¡¹å¼çº¿å‹æ¨¡å‹*</span> [*High (or very high) order polynomial regression in R (or alternatives?)*](https://stackoverflow.com/a/39803843/3806250)](æ–‡è‰ºåŠå›¾åº“/polynomials and orthogonal polymials 3.png)

![<span style='color:Orange'>*å›¾åƒ3.2.3aï¼šæ‹Ÿåˆç”±`leaps :: regsubsets`é€‰æ‹©çš„å¤šé¡¹å¼å›å½’æ¨¡å‹*</span> [*å…³äºrï¼šæ‹Ÿåˆç”±`leaps :: regsubsets`é€‰æ‹©çš„å¤šé¡¹å¼å›å½’æ¨¡å‹*](https://www.codenong.com/51223897)](æ–‡è‰ºåŠå›¾åº“/æ‹Ÿåˆç”±leaps regsubsetsé€‰æ‹©çš„å¤šé¡¹å¼å›å½’æ¨¡å‹1.png)

![<span style='color:Orange'>*å›¾åƒ3.2.3bï¼šæ‹Ÿåˆç”±`leaps :: regsubsets`é€‰æ‹©çš„å¤šé¡¹å¼å›å½’æ¨¡å‹*</span> [*å…³äºrï¼šæ‹Ÿåˆç”±`leaps :: regsubsets`é€‰æ‹©çš„å¤šé¡¹å¼å›å½’æ¨¡å‹*](https://www.codenong.com/51223897)](æ–‡è‰ºåŠå›¾åº“/æ‹Ÿåˆç”±leaps regsubsetsé€‰æ‹©çš„å¤šé¡¹å¼å›å½’æ¨¡å‹2.png)

```{r}
mdp <- dir('data', pattern = '^mp') %>% 
    ldply(., function(x) {
        read_rds(paste0('æ–‡è‰ºæ•°æ®åº“/', x))
    }) %>% 
    as_tibble
```

```{r}
mdp %>% 
  mutate(
    df = color_tile('#2a52be', 'white')(df), #colbalt
    AIC = ifelse(
      rank(AIC) <= 3, 
      cell_spec(
        paste0(round(AIC, 2), ' (rank: ', sprintf('%1.f', rank(AIC)), ')'), 
        'html', color = 'darkgoldenrod', bold = T), 
      cell_spec(
        paste0(round(AIC, 2), ' (rank: ', sprintf('%1.f', rank(AIC)), ')'), 
        'html', color = 'grey', italic = T))) %>% 
  kbl('html', caption = 'åˆ†ç»„æœ€ä¼˜æ¨¡å‹', escape = F, align = c('c', 'r', 'r')) %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  kable_material() %>% 
  pack_rows('å¤šé¡¹å¼å›å½’ 2', 1, 22, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼å›å½’ 3', 23, 44, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼å›å½’ 4', 45, 65, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼å›å½’ 5', 67, 88, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼æ­£äº¤å›å½’ 2', 89, 110, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼æ­£äº¤å›å½’ 3', 111, 132, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼æ­£äº¤å›å½’ 4', 133, 154, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼æ­£äº¤å›å½’ 5', 155, 176, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼åŸå§‹å›å½’ 2', 177, 198, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼åŸå§‹å›å½’ 3', 199, 220, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼åŸå§‹å›å½’ 4', 221, 242, label_row_css = 'background-color: #666; color: #fff;') %>% 
  pack_rows('å¤šé¡¹å¼åŸå§‹å›å½’ 5', 243, 264, label_row_css = 'background-color: #666; color: #fff;') %>% 
  scroll_box(height = '400px')
```

<span style='color:Orange'>*å›¾è¡¨3.2.1.1ï¼šåˆ†ç»„æœ€ä¼˜æ¨¡å‹*</span>

```{r}
mdp %>% 
  arrange(AIC) %>% 
  mutate(
    df = color_tile('#2a52be', 'white')(df), #colbalt
    AIC = ifelse(
      rank(AIC) <= 3, 
      cell_spec(
        paste0(round(AIC, 2), ' (rank: ', sprintf('%1.f', rank(AIC)), ')'), 
        'html', color = 'darkgoldenrod', bold = T), 
      cell_spec(
        paste0(round(AIC, 2), ' (rank: ', sprintf('%1.f', rank(AIC)), ')'), 
        'html', color = 'grey', italic = T))) %>% 
  kbl('html', caption = 'æœ€ä¼˜æ¨¡å‹æ’è¡Œæ¦œ', escape = F, align = c('c', 'r', 'r')) %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  kable_material() %>% 
  scroll_box(height = '400px')
```

<span style='color:Orange'>*å›¾è¡¨3.2.1.2ï¼šæœ€ä¼˜æ¨¡å‹æ’è¡Œæ¦œ*</span>

<span style='color:Red'>**å¤‡æ³¨ï¼šç”±äºè€—æ—¶ï¼Œä»¥ä¸Šå¤šå…ƒå¤šé¡¹å¼æ¨¡å‹å¹¶æ— å°†æ¨¡å‹å†…çš„å‚æ•°ä¸ªåˆ«ä¼˜åŒ–**`p22 = lm(Profit ~ poly(Turnover, degree = 2, raw = TRUE) * ` `poly(Won, degree = 3, raw = TRUE) * ` `poly(Cancelled, degree = 4, raw = TRUE) * ` `poly(Rebates, degree = 5, raw = TRUE), smp2)`</span>^[[binary.com é¢è¯•è¯•é¢˜ I - GARCHæ¨¡å‹ä¸­çš„ARIMA(p,d,q)å‚æ•°æœ€ä¼˜åŒ–](https://rpubs.com/englianhu/binary-Q1FiGJRGARCH)è™½ç„¶æ˜¯å•å˜é‡æ¨¡å‹ï¼Œä¸è¿‡ä¼šè‡ªåŠ¨é«˜æ•ˆå¤„ç†å¹¶ç­›é€‰æœ€ä¼˜`arima(p,d,q)`å‚æ•°]

<br>
<br>

## å¤šå…ƒå†…åµŒæ¨¡å‹

<br>

ä»¥ä¸‹æ–‡çŒ®åŒ…å«`å¤šå…ƒç›¸äº’å¼æ¨¡å‹`ã€`å¤šé¡¹å¼æ¨¡å‹`ã€`å¤šå…ƒå†…åµŒæ¨¡å‹`ã€‚

- [å¦‚ä½• Estimate linear models](https://d.cosx.org/d/419820-estimate-linear-models)å’Œ[`lm()`åŒ…ä¸­formula è¡¨è¾¾æ–¹æ³•çš„é—®é¢˜](https://d.cosx.org/d/157623-157623)^[å¤šç›¸äº’ä½œç”¨å’Œå†…åµŒçº¿æ€§æ¨¡å‹]
- [R-Blog : Using R and lme/lmer to fit different two- and three-level longitudinal models](https://www.r-bloggers.com/2015/04/using-r-and-lmelmer-to-fit-different-two-and-three-level-longitudinal-models/)^[åŸç¨¿:[Using R and lme/lmer to fit different two- and three-level longitudinal models](https://rpsychologist.com/r-guide-longitudinal-lme-lmer)å¤šå…ƒå†…åµŒçº¿å‹æ¨¡å‹]
- [Linear Regression and group by in R](https://stats.stackexchange.com/questions/31204/why-do-i-get-wildly-different-results-for-polyraw-t-vs-poly)
- [using lm(poly) to get formula coeff[duplicate]](https://stackoverflow.com/questions/17457884/using-lmpoly-to-get-formula-coeff)
- [Fitting polynomial model to data in R](https://stackoverflow.com/questions/3822535/fitting-polynomial-model-to-data-in-r)
- [R LME4 mixed models with nesting and nesting-interactions](https://stackoverflow.com/questions/62423505/r-lme4-mixed-models-with-nesting-and-nesting-interactions)
- [lmer poly() function on interactions](https://stackoverflow.com/questions/58943913/lmer-poly-function-on-interactions)^[å†…åµŒå¤šé¡¹å¼çº¿å‹æ¨¡å‹(Polynomial Regression)]

```{r, eval = FALSE}
dir('data', pattern = '^m.+rds$') %>% 
    ldply(., function(x) {
        read_rds(paste0('æ–‡è‰ºæ•°æ®åº“/', x))
    }) %>% arrange(AIC) %>% 
    dplyr::slice(1:5) %>% 
  mutate(
    df = color_tile('#2a52be', 'white')(df), #colbalt
    AIC = ifelse(
      rank(AIC) <= 3, 
      cell_spec(
        paste0(round(AIC, 2), ' (rank: ', sprintf('%1.f', rank(AIC)), ')'), 
        'html', color = 'darkgoldenrod', bold = T), 
      cell_spec(
        paste0(round(AIC, 2), ' (rank: ', sprintf('%1.f', rank(AIC)), ')'), 
        'html', color = 'grey', italic = T))) %>% 
  kbl('html', caption = 'æœ€ä¼˜æ¨¡å‹', escape = F, align = c('c', 'r', 'r')) %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  kable_material() %>% 
  scroll_box(height = '400px')
```

ç”±äºå¤šé¡¹å¼çº¿å‹æ¨¡å‹æ— æ³•åˆ—å…¥æ—¶é—´åºåˆ—å‚æ•°å’Œå› å­å‚æ•°ï¼Œæ•…æ­¤`lm(Profit ~ poly(Bettor, degree = i, raw = TRUE) * ` `poly(Turnover, degree = i, raw = TRUE) * ` `poly(Won, degree = i, raw = TRUE) * ` `poly(Cancelled, degree = i, raw = TRUE) * ` `poly(Rebates, degree = i, raw = TRUE), smp2)`ä¸ºæœ€ä¼˜æ¨¡å‹ï¼Œè¿™å„¿æˆ‘å…ˆæ·»åŠ å†…åµŒæ¨¡å‹ã€‚

```{r, eval = FALSE}
mm = lmer(Profit ~ 
             poly(Bettor, degree = 2, raw = FALSE) * 
             poly(Turnover, degree = 2, raw = FALSE) * 
             poly(Won, degree = 2, raw = FALSE) * 
             poly(Cancelled, degree = 2, raw = FALSE) * 
             poly(Rebates, degree = 2, raw = FALSE) * (1/Date), smp2) %>% 
    extractAIC %>% 
    as_tibble %>% 
    t %>% as_tibble %>% 
    dplyr::rename(df = V1, AIC = V2) %>% 
    mutate(.md = paste0('mprf_p07'), degree = 2, raw = FALSE) %>% 
    dplyr::select(.md, degree, df, AIC)
write_rds(p07, paste0('æ–‡è‰ºæ•°æ®åº“/mprf', i, '_p07.rds'))



llply(5, function(i) {
    mprf = list(
        {mm01 = lm(Profit ~ Date * 
                       poly(Bettor, degree = i, raw = FALSE) * 
                       poly(Turnover, degree = i, raw = FALSE) * 
                       poly(Won, degree = i, raw = FALSE) * 
                       poly(Cancelled, degree = i, raw = FALSE) * 
                       poly(Rebates, degree = i, raw = FALSE), smp2) %>% 
            extractAIC %>% 
            as_tibble %>% 
            t %>% as_tibble %>% 
            dplyr::rename(df = V1, AIC = V2) %>% 
            mutate(.md = paste0('mmprf_p01'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(mm01, paste0('æ–‡è‰ºæ•°æ®åº“/mmprf', i, '_p01.rds'))}, 
        {mm02 = lmer(Profit ~ Date * 
                   poly(Bettor, degree = i, raw = FALSE) * 
                       poly(Turnover, degree = i, raw = FALSE) * 
                       poly(Won, degree = i, raw = FALSE) * 
                       poly(Cancelled, degree = i, raw = FALSE) * 
                     (1 / Date), smp2) %>% 
            extractAIC %>% 
            as_tibble %>% 
            t %>% as_tibble %>% 
            dplyr::rename(df = V1, AIC = V2) %>% 
            mutate(.md = paste0('mmprf_p02'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(mm02, paste0('æ–‡è‰ºæ•°æ®åº“/mmprf', i, '_p02.rds'))}, 
        {mm03 = lmer(Profit ~ Date * 
                      poly(Bettor, degree = i, raw = FALSE) * 
                      poly(Turnover, degree = i, raw = FALSE) * 
                      poly(Won, degree = i, raw = FALSE) * 
                      poly(Rebates, degree = i, raw = FALSE) * 
                     (1 / Type), smp2) %>% 
            extractAIC %>% 
            as_tibble %>% 
            t %>% as_tibble %>% 
            dplyr::rename(df = V1, AIC = V2) %>% 
            mutate(.md = paste0('mmprf_p03'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(mm03, paste0('æ–‡è‰ºæ•°æ®åº“/mmprf', i, '_p03.rds'))}, 
        {mm04 = lmer(Profit ~ Date * 
                      poly(Bettor, degree = i, raw = FALSE) * 
                      poly(Turnover, degree = i, raw = FALSE) * 
                      poly(Cancelled, degree = i, raw = FALSE) * 
                      poly(Rebates, degree = i, raw = FALSE) * 
                       (1 / Date) * (1 / Type), smp2) %>% 
            extractAIC %>% 
            as_tibble %>% 
            t %>% as_tibble %>% 
            dplyr::rename(df = V1, AIC = V2) %>% 
            mutate(.md = paste0('mmprf_p04'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p04, paste0('æ–‡è‰ºæ•°æ®åº“/mmprf', i, '_p04.rds'))}, 
        {mm05 = lmer(Profit ~ Date * 
                      poly(Bettor, degree = i, raw = FALSE) * 
                      poly(Won, degree = i, raw = FALSE) * 
                      poly(Cancelled, degree = i, raw = FALSE) * 
                      poly(Rebates, degree = i, raw = FALSE) * 
                     (Date / Type), smp2) %>% 
            extractAIC %>% 
            as_tibble %>% 
            t %>% as_tibble %>% 
            dplyr::rename(df = V1, AIC = V2) %>% 
            mutate(.md = paste0('mmprf_p05'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p05, paste0('æ–‡è‰ºæ•°æ®åº“/mmprf', i, '_p05.rds'))}, 
        {mm06 = lmer(Profit ~ Date * 
                      poly(Bettor, degree = i, raw = FALSE) * 
                      poly(Won, degree = i, raw = FALSE) * 
                      poly(Cancelled, degree = i, raw = FALSE) * 
                      poly(Rebates, degree = i, raw = FALSE) * 
                     (Type / Date), smp2) %>% 
            extractAIC %>% 
            as_tibble %>% 
            t %>% as_tibble %>% 
            dplyr::rename(df = V1, AIC = V2) %>% 
            mutate(.md = paste0('mmprf_p06'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p06, paste0('æ–‡è‰ºæ•°æ®åº“/mmprf', i, '_p06.rds'))}, 
        {mm07 = lmer(Profit ~ Date * 
                      poly(Bettor, degree = i, raw = FALSE) * 
                      poly(Won, degree = i, raw = FALSE) * 
                      poly(Cancelled, degree = i, raw = FALSE) * 
                      poly(Rebates, degree = i, raw = FALSE) * 
                     (1 + CondA * CondB | Sub) * (Type / Date), smp2) %>% 
            extractAIC %>% 
            as_tibble %>% 
            t %>% as_tibble %>% 
            dplyr::rename(df = V1, AIC = V2) %>% 
            mutate(.md = paste0('mmprf_p07'), degree = i, raw = FALSE) %>% 
            dplyr::select(.md, degree, df, AIC); 
        write_rds(p06, paste0('æ–‡è‰ºæ•°æ®åº“/mmprf', i, '_p07.rds'))}
    ) %>% 
        ldply %>% 
        as_tibble

## random effects with nested model
mm000 = lmer(Profit ~ Date * 
              poly(Bettor, degree = 2, raw = FALSE) * 
              poly(Won, degree = 2, raw = FALSE) * 
              poly(Cancelled, degree = 2, raw = FALSE) * 
              poly(Rebates, degree = 2, raw = FALSE) * 
              (1 + Won * Cancelled | Bettor) * (Type / Date), smp2) %>% 
    extractAIC
write_rds(mm000, paste0('æ–‡è‰ºæ•°æ®åº“/mm000.rds'))

## nested model
mm001 = lm(Profit ~ Date * 
               poly(Bettor, degree = 2, raw = FALSE) * 
               poly(Won, degree = 2, raw = FALSE) * 
               poly(Cancelled, degree = 2, raw = FALSE) * 
               poly(Rebates, degree = 2, raw = FALSE) * 
               (1 + Won * Cancelled / Bettor) * (Type / Date), smp2) %>% 
    extractAIC
write_rds(mm001, paste0('æ–‡è‰ºæ•°æ®åº“/mm001.rds'))

## lmer(y~poly(x,2,raw=TRUE)+(1|f)+(0+x|f)+(0+I(x^2)|f),
##            data=d)

## random effects with nested model
mm000_d3 = lmer(Profit ~ Date * 
              poly(Bettor, degree = 3, raw = FALSE) * 
              poly(Won, degree = 3, raw = FALSE) * 
              poly(Cancelled, degree = 3, raw = FALSE) * 
              poly(Rebates, degree = 3, raw = FALSE) * 
              (1 + Won * Cancelled | Bettor) * (Type / Date), smp2) %>% 
    extractAIC
write_rds(mm000_d3, paste0('æ–‡è‰ºæ•°æ®åº“/mm000_d3.rds'))

## nested model
mm001_d3 = lm(Profit ~ Date * 
               poly(Bettor, degree = 3, raw = FALSE) * 
               poly(Won, degree = 3, raw = FALSE) * 
               poly(Cancelled, degree = 3, raw = FALSE) * 
               poly(Rebates, degree = 3, raw = FALSE) * 
               (1 + Won * Cancelled / Bettor) * (Type / Date), smp2) %>% 
    extractAIC
write_rds(mm001_d3, paste0('æ–‡è‰ºæ•°æ®åº“/mm001_d4.rds'))

```

<br>
<br>

## æ··åˆæ¨¡å‹

<br>

ä»¥ä¸‹æ–‡çŒ®åŒ…å«`å¤šå…ƒç›¸äº’å¼æ¨¡å‹`ã€`å¤šé¡¹å¼æ¨¡å‹`ã€`å¤šå…ƒå†…åµŒæ¨¡å‹`ã€‚

- [æ··åˆçº¿æ€§æ¨¡å‹çš„å®ç°ï¼ˆæ›´æ–°20190607ï¼‰](https://zhuanlan.zhihu.com/p/63092231)
- [Linear Regression and group by in R](https://stackoverflow.com/a/12064463/3806250)
- [Why do I get wildly different results for poly(raw=T) vs. poly()?](https://stats.stackexchange.com/a/31222/68357)

![[*Linear Regression and group by in R*](https://stackoverflow.com/a/12064463/3806250)](æ–‡è‰ºåŠå›¾åº“/nested-polynomial-lm.png)

```{r}
## https://stackoverflow.com/a/24133767/3806250


```

<br>
<br>

## æ—¶é—´åºåˆ—æ¨¡å‹

<br>

ä¸Šä¸ªç« èŠ‚è°ˆåŠæœ€ä¼˜ä¸‰ä¸ªæ¨¡å‹ï¼Œè¿™å„¿å’±ä»¬å¾—å…ˆç§ç§*å›¾è¡¨3.1ï¼šæ¯æ—¥è§‚æµ‹å€¼*æ¯æ—¥è§‚æµ‹å€¼å†å†³å®šæ•°æ®å¤šå¯¡ã€‚

```{r}

```


<br>
<br>

### 30å¤©æ•°æ®

<br>

```{r}
##https://stackoverflow.com/questions/24133356/how-to-replicate-a-ddply-behavior-that-uses-a-custom-function-with-dplyr/24133767#24133767

```

<br>
<br>

### 40å¤©æ•°æ®

<br>

....

<br>
<br>

# ç»˜å›¾

<br>

## æŠ•æ³¨äººæ•°

<br>

## æŠ•æ³¨é‡‘é¢

<br>

## ä¸­å¥–é‡‘é¢

<br>

## æ’¤å•é‡‘é¢

<br>

## è¿”ç‚¹é‡‘é¢

<br>

## ç›ˆåˆ©

<br>

## ç›ˆç‡

<br>
<br>

# ç»“è®º

<br>

## æ€»ç»“

${\color{Black} \circledR} {\color{DarkGreen} \gamma} {\color{Red} \sigma} \; {\color{Blue} \xi} {\color{Red} \eta} {\color{Blue} g}$^[[Latex Equation](https://www.codecogs.com/latex/eqneditor.php)] ğŸ^[[Emoji list](https://gist.github.com/rxaviers/7360908)]

<br>


<br><br>

# é™„å½•

## æ–‡ä¹¦æ˜ç»†

ä»¥ä¸‹ä¹ƒæ­¤æ–‡ä¹¦çš„æ–‡ä»¶ä¿¡æ¯ã€‚

- æ–‡é›†å»ºç«‹æ—¥ï¼š2022-05-31
- æ–‡é›†æœ€æ–°æ›´æ–°æ—¥ï¼š`r today('Asia/Shanghai')`
- `r R.version.string`
- [**rmarkdown**](https://github.com/rstudio/rmarkdown) ç¨‹åºåŒ…ç‰ˆæœ¬ï¼š`r packageVersion('rmarkdown')`
- æ–‡é›†ç‰ˆæœ¬ï¼š0.2.1
- æ–‡é›†ä½œè€…ï¼š[Â®Î³Ïƒ, Î¾Î·g LÎ¹Î±Î· Î—Î¼](https://rpubs.com/englianhu/ryo-cn)
- çŒ«èˆï¼š[æºä»£ç ](https://github.com/englianhu/report)
- è¿½åŠ é™„å±ä¿¡æ¯

```{r info}
#suppressMessages(require('formattable', quietly = TRUE))
#suppressMessages(require('knitr', quietly = TRUE))
#suppressMessages(require('kableExtra', quietly = TRUE))
#suppressMessages(require('magittr', quietly = TRUE))
#suppressMessages(require('devtools', quietly = TRUE))

sys1 <- session_info()$platform |> 
    unlist() |> 
    {\(.) data.frame(row.names = 1:length(.), 
                     Category = names(.), session_info = .)}()

sys2 <- data.frame(Sys.info()) |> 
    {\(.) data.frame(Category = row.names(.), Sys.info = .[,1])}()

#remarks, dim(sys1), dim(sys2)
if (nrow(sys1) == 11 && nrow(sys2) == 8) {
  sys2 <- sys2 |> 
    {\(.) rbind(., data.frame(
    Category = c('rmarkdown', 'rsconnect', 'Current time'), 
    Sys.info = c(as.character(getwd()), 
                 as.character(packageVersion('rsconnect')), 
                 paste(as.character(lubridate::now('Asia/Shanghai')), 'CST ğŸ—º'))))}()
  
} else if (nrow(sys1) == 10 && nrow(sys2) == 8) {
  sys1 <- rbind(sys1, data.frame(Category = '', session_info = ''))
  
  sys2 <- sys2 |> 
    {\(.) rbind(., data.frame(
    Category = c('rmarkdown', 'rsconnect', 'Current time'), 
    Sys.info = c(as.character(getwd()), 
                 as.character(packageVersion('rsconnect')), 
                 paste(as.character(lubridate::now('Asia/Shanghai')), 'CST ğŸ—º'))))}()
}

sys <- cbind(sys1, sys2) |> 
  {\(.) 
    kbl(., caption = 'Additional session information:')}() |> 
  {\(.) 
    kable_styling(., bootstrap_options = c('striped', 'hover', 'condensed', 'responsive'))}() |> 
  {\(.) 
    row_spec(., 0, background = 'DimGrey', color = 'yellow')}() |> 
  {\(.) 
    column_spec(., 1, background = 'CornflowerBlue', color = 'red')}() |> 
  {\(.) 
    column_spec(., 2, background = 'grey', color = 'black')}() |> 
  {\(.) 
    column_spec(., 3, background = 'CornflowerBlue', color = 'blue')}() |> 
  {\(.) 
    column_spec(., 4, background = 'grey', color = 'white')}() |> 
  {\(.) 
    row_spec(., 11, bold = TRUE, color = 'yellow', background = '#D7261E')}()

rm(sys1, sys2)
sys
```

## å‚è€ƒæ–‡çŒ®

1) [Free themes for Bootstrap](https://bootswatch.com/3/)
2) [R packages for optimal stratified sampling: a review and compared evaluation](https://www.researchgate.net/publication/327791484_R_packages_for_optimal_stratified_sampling_a_review_and_compared_evaluation/comments)
3) [Use of models in SamplingStrata](https://cran.r-project.org/web/packages/SamplingStrata/vignettes/models.html)
4) [Example of Using a Banner Image with RMarkdown](https://rpubs.com/thaufas/555157)
5) [IN R MARKDOWN, How Can I add a background image (HTML output)?](https://stackoverflow.com/questions/60498668/in-r-markdown-how-can-i-add-a-background-image-html-output)
6) [CSS Background Image Size Tutorial â€“ How to Code a Full Page Background Image](https://www.freecodecamp.org/news/css-full-page-background-image-tutorial)
7) [GitHub : Statistical Rethinking (2022 Edition)](https://github.com/englianhu/stat_rethinking_2022)
8) [GitHub : `rethinking` package](https://github.com/englianhu/rethinking) McElreath 2020. Statistical Rethinking, 2nd edition
9) [GitHub : Stan](https://github.com/stan-dev)
10) [GitHub : Repository for distributing (some) stan-dev R packages](https://github.com/stan-dev/r-packages)
11) [ä¹¦æ ˆç½‘](https://www.bookstack.cn/user/englianhu)

---

[<img src="æ–‡è‰ºåŠå›¾åº“/Scibrokes.png" height="14"/> SÏ‚Î¹Î²rÎ¿ÎºÎµrs TrÎ±dÎ¹Î·gÂ®](http://www.scibrokes.com)<br>
<span style='color:RoyalBlue'>**[<img src="æ–‡è‰ºåŠå›¾åº“/Scibrokes.png" height="14"/> ä¸–åšé‡åŒ–Â®](http://www.scibrokes.com)ä¼ä¸šçŸ¥è¯†äº§æƒåŠç‰ˆæƒæ‰€æœ‰ï¼Œç›—ç‰ˆå¿…ç©¶ã€‚**</span>
