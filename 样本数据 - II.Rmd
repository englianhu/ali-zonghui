---
title: "ç›ˆåˆ©æ¨¡å¼"
subtitle: "åˆ†æè´­å½©åŠ©æ‰‹æ•°æ® (ç¬¬IIéƒ¨)"
author: "ç‰¹é‚€å¯¼å¸ˆ - èœèœ <img src='www/æ™¯çŸ¥å¤å°å§.jpg' height='24'>"
date: "`r lubridate::today()`"
output:
  html_document: 
    mathjax: https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    code_folding: hide
    css: CSSBackgrounds.css
  html_notebook: 
    mathjax: https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    code_folding: hide
    css: CSSBackgrounds.css
---

# è®¾å®š

## SCSS è®¾ç½®

<style>
pre {
  overflow-x: auto;
}
pre code {
  word-wrap: normal;
  white-space: pre;
}
.table-hover > tbody > tr:hover { 
  background-color: #8D918D;
}
</style>

```{r load-sass, class.source='bg-success', class.output='bg-primary'}
# install.packages('remotes', dependencies = TRUE, INSTALL_opts = '--no-lock')
library('BBmisc', 'rmsfuns')
#remotes::install_github("rstudio/sass")
lib('sass')

## https://support.rstudio.com/hc/en-us/articles/200532197
## https://community.rstudio.com/t/r-does-not-display-korean-chinese/30889/3?u=englianhu
#Sys.setlocale("LC_CTYPE", "en_US.UTF-8")
#Sys.setlocale("LC_CTYPE", "zh_CN.UTF-8")
#Sys.setlocale(category = "LC_CTYPE", "Chinese (Simplified)_China.936")
#Sys.setlocale(locale = "Chinese")
#Sys.setlocale(locale = "Japanese")
#Sys.setlocale(locale = "English")

# rmarkdown::render('/home/englianhu/Documents/owner/ryo-cn.Rmd',  encoding = 'UTF-8')
#Sys.setlocale("LC_CTYPE", "UTF-8")
#Sys.setlocale(locale = "UTF-8")
#Sys.setlocale(category = "LC_ALL", locale = "chs")
#Sys.setlocale(category = "LC_ALL", locale = "UTF-8")
#Sys.setlocale(category = "LC_ALL", locale = "Chinese")
#Sys.setlocale(category = "LC_ALL", locale = "zh_CN.UTF-8")
Sys.setlocale("LC_ALL", "en_US.UTF-8")
```

```{scss set-scss, class.source='bg-success', class.output='bg-primary'}
/* https://stackoverflow.com/a/66029010/3806250 */
h1 { color: #002C54; }
h2 { color: #2F496E; }
h3 { color: #375E97; }
h4 { color: #556DAC; }
h5 { color: #92AAC7; }

/* ----------------------------------------------------------------- */
/* https://gist.github.com/himynameisdave/c7a7ed14500d29e58149#file-broken-gradient-animation-less */
.hover01 {
  /* color: #FFD64D; */
  background: linear-gradient(155deg, #EDAE01 0%, #FFEB94 100%);
  transition: all 0.45s;
  &:hover{
    background: linear-gradient(155deg, #EDAE01 20%, #FFEB94 80%);
    }
  }

.hover02 {
  color: #FFD64D;
  background: linear-gradient(155deg, #002C54 0%, #4CB5F5 100%);
  transition: all 0.45s;
  &:hover{
    background: linear-gradient(155deg, #002C54 20%, #4CB5F5 80%);
    }
  }

.hover03 {
  color: #FFD64D;
  background: linear-gradient(155deg, #A10115 0%, #FF3C5C 100%);
  transition: all 0.45s;
  &:hover{
    background: linear-gradient(155deg, #A10115 20%, #FF3C5C 80%);
    }
  }
```

```{r gb-opts, class.source='hover01', class.output='hover02'}
## Set the timezone but not change the datetime
Sys.setenv(TZ = 'Asia/Shanghai')

## Setting to omit all warnings
## https://stackoverflow.com/a/36846793/3806250
## Set width
## options(knitr.table.format = 'html') will set all kableExtra tables to be 'html', otherwise need to set the parameter on every single table.
options(warn = -1, width = 999, knitr.table.format = 'html')#, digits.secs = 6)

## https://stackoverflow.com/questions/39417003/long-vectors-not-supported-yet-abnor-in-rmd-but-not-in-r-script
## https://yihui.org/knitr/options
knitr::opts_chunk$set(
  class.source = 'hover01', class.output = 'hover02', class.error = 'hover03', 
  message = FALSE, warning = FALSE, error = TRUE, 
  autodep = TRUE, aniopts = 'loop', 
  progress = TRUE, verbose = TRUE, 
  cache = FALSE, cache.lazy = FALSE, result = 'asis')
```

<br><br>

## è®¾ç½®

```{r libs, eval=FALSE}
## Setup Options, Loading Required Libraries and Preparing Environment
## Loading the packages and setting adjustment
source('function/libs.R')
```

è¯»å–ç¨‹åºåŒ…

```{r load-pkgs}
## Setup Options, Loading Required Libraries and Preparing Environment
## 3210448065@qq.com
## leiou123

## 2849108450@qq.com
## leiou123
## https://rstudio.cloud/project/1198888

## Loading the package 'BBmisc'
if(suppressMessages(!require('BBmisc'))){
  install.packages('BBmisc', dependencies = TRUE, INSTALL_opts = '--no-lock')
  suppressMessages(library('BBmisc'))
}
if (suppressMessages(!require('rmsfuns'))) {
  install.packages('rmsfuns', dependencies = TRUE, INSTALL_opts = '--no-lock')
  suppressMessages(library('rmsfuns'))
}

if(!require('REmap')) devtools::install_github('lchiffon/REmap')

## Loading multiple packages at once
#pkgs <- c('readr', 'plyr', 'dplyr', 'magrittr', 'tidyverse', 'devtools', 'zoo', 'lubridate', 'stringr', 'rvest', 'markdown', 'googleVis', 'knitr', 'rmarkdown', 'htmltools', 'knitr', 'kableExtra', 'formattable', 'echarts4r', 'radarchart', 'MASS', 'htmlwidgets', 'maps', 'REmap', 'ggmap', 'vembedr')

pkgs <- c('plyr', 'dplyr', 'magrittr', 'stringr', 'knitr', 'kableExtra', 'lubridate', 'broom', 'purrr', 'readxl', 'tibble', 'DT')

suppressAll(lib(pkgs))
load_pkg(pkgs)
rm(pkgs)

## Set the googleVis options first to change the behaviour of plot.gvis, so that 
##  only the chart component of the HTML file is written into the output file.
op <- options(gvis.plot.tag = 'chart')

## <audio src='music/bigmoney.mp3' autoplay controls loop></audio>
```

```{r set-prefer}
conflict_prefer('filter', 'dplyr')
conflict_prefer('select', 'dplyr')
conflict_prefer('mutate', 'dplyr')
conflict_prefer('rename', 'dplyr')
```

<br><br>

# æ•°æ®

## æ ·æœ¬æ•°æ®

è´¦å·ï¼š`zxg00123`ï¼Œä»¥ä¸‹æ˜¯ä»æˆ‘ä»¬å¹³å°è´­å½©åŠ©æ‰‹ä¸­çš„å®˜æ–¹æ•°æ®é‡‡é›†ä¸‹æ¥çš„æ•°æ®ï¼Œä»€ä¹ˆå½©ç§éƒ½å¯ä»¥åˆ†æï¼Œå°±æ‹¿ä¸ªä¸»æ‰“**1åˆ†å¿«3**ä¸ºæ ·æœ¬ã€‚

![](figure/QQå›¾ç‰‡20200627153341.png)

```{r read-data}
hml <- read.delim(file = '1åˆ†å¿«3æ ·æœ¬æ•°æ®2.txt')
hml %<>% 
  unlist %>% 
  as.character

#æ—¶é—´ æœŸæ•° å·ç  å¤§å°/å•åŒ é±¼è™¾èŸ¹
#12:41 0761 dice1 dice1 dice57 å° å• é±¼ é±¼ èŸ¹
smp <- c('12:41', '0761', 'dice1 dice1 dice5', '7 å° å•', 'é±¼ é±¼ èŸ¹') %>% 
  matrix(ncol = 1, byrow = TRUE) %>% 
  t %>% 
  data.frame
nm <- c('æ—¶é—´', 'æœŸæ•°', 'å·ç ', 'å¤§å°/å•åŒ', 'é±¼è™¾èŸ¹')
names(smp) <- nm
smp %<>% 
  as_tibble

smp %>% 
  kable(caption = '1åˆ†å¿«3æ ·æœ¬æ•°æ®') %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  row_spec(0, bold = TRUE, color = '#FDD017', background = '#3A3B3C') %>% 
  row_spec(1, color = '#FFFF00', background = '#657383')
```

ä»¥ä¸Šæ˜¯åŸå§‹æ ·æœ¬æ•°æ®ç»“æ„ã€‚

## æ•´ç†æ•°æ®

```{r clean-data}
smpp <- hml %>% 
  llply(., function(x) {
    x %>% 
      str_extract_all('([0-9]{2}:[0-9]{2})|([0-9]{1,2}%)|(\\w+)') %>% 
      unlist %>% 
      str_replace_all('2e1d3b04', '') %>% 
      str_replace_all('([0-9]+[a-zA-Z]+)|([a-zA-Z]+)|[0-9]{1,2}%', '') %>% 
      .[nchar(.)>0] %>% 
      t %>% 
      data.frame
    }) %>% 
  bind_rows %>% 
  as_tibble

names(smpp) <- c('æ—¶é—´', 'æœŸæ•°', 'éª°å­1', 'éª°å­2', 'éª°å­3', 'æ€»å€¼', 'å¤§å°', 'å•åŒ', 'é±¼è™¾èŸ¹1', 'é±¼è™¾èŸ¹2', 'é±¼è™¾èŸ¹3')

smpp %<>% mutate(
  `æ—¶é—´` = hm(`æ—¶é—´`), `æœŸæ•°` = factor(`æœŸæ•°`), 
  `éª°å­1` = as.numeric(`éª°å­1`), `éª°å­2` = as.numeric(`éª°å­2`), 
  `éª°å­3` = as.numeric(`éª°å­3`), `æ€»å€¼` = as.numeric(`æ€»å€¼`), 
  `å¤§å°` = factor(`å¤§å°`), `å•åŒ` = factor(`å•åŒ`), 
  `é±¼è™¾èŸ¹1` = factor(`é±¼è™¾èŸ¹1`), `é±¼è™¾èŸ¹2` = factor(`é±¼è™¾èŸ¹2`), 
  `é±¼è™¾èŸ¹3` = factor(`é±¼è™¾èŸ¹3`))

smppp <- smpp[c('æ€»å€¼', 'å¤§å°', 'å•åŒ')]

smpp %>% 
  datatable(
    caption = "1åˆ†å¿«3æ ·æœ¬æ•°æ®", 
    escape = FALSE, filter = 'top', rownames = FALSE, 
    extensions = list(
      'ColReorder' = NULL, 'RowReorder' = NULL, 
      'Buttons' = NULL, 'Responsive' = NULL), 
    options = list(
      dom = 'BRrltpi', autoWidth = TRUE,  scrollX = TRUE, 
      lengthMenu = list(c(10, 50, 100, -1), c('10', '50', '100', 'All')), 
      ColReorder = TRUE, rowReorder = TRUE, 
      buttons = list('copy', 'print', 
                     list(extend = 'collection', 
                          buttons = c('csv', 'excel', 'pdf'), 
                          text = 'Download'), I('colvis'))))
```

ä»¥ä¸Šæ˜¯æ•´ç†è¿‡çš„æ ·æœ¬æ•°æ®ã€‚

<br><br>

# ç»Ÿè®¡æ¨¡å‹

## åŸºæœ¬åˆ†æ

```{r prob-overview}
smpp[-c(1:2)] %>% 
  llply(table)
```

```{r prob-tbl}
yy <- suppressMessages(
  llply(3:18, function(i) {
    dpois(i, smppp$æ€»å€¼) %>% 
      round(2)
    }) %>% 
    bind_cols)

names(yy) <- paste0('X', 3:18)
yy <- data.frame(smppp, yy) %>% 
  as_tibble

yy %>% 
  kable(caption = 'å’Œå€¼æ¦‚ç‡æ˜ç»†') %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  row_spec(0, bold = TRUE, color = '#FDD017', background = '#3A3B3C') %>% 
  row_spec(seq(1, nrow(yy), by = 2), color = '#FFFF00', background = '#657383') %>% 
  row_spec(seq(2, nrow(yy), by = 2), color = '#FFFF00', background = '#C0C0C0') %>% 
  scroll_box(width = '100%', height = '400px')
```

ä»¥ä¸Šå›¾è¡¨æ˜¾ç¤ºéª°å­æ€»å€¼ä»`3`åˆ°`18`çš„æ¦‚ç‡æ˜ç»†ã€‚

```{r prob-dist}
table(smpp$`æ€»å€¼`)
prop.table(table(smpp$`æ€»å€¼`))
barplot(prop.table(table(smpp$`æ€»å€¼`)))
```

ä»¥ä¸Šå›¾è¡¨æ˜¾ç¤ºéª°å­æ€»å€¼ä»`3`åˆ°`18`çš„æ¦‚ç‡ã€‚

```{r}
table(smpp$`å¤§å°`)
prop.table(table(smpp$`å¤§å°`))
barplot(prop.table(table(smpp$`å¤§å°`)))
```

ä»¥ä¸Šå›¾è¡¨æ˜¾ç¤ºéª°å­æ€»å€¼å¼€`å¤§`æˆ–`å°`çš„æ¦‚ç‡ã€‚

```{r}
table(smpp$`å•åŒ`)
prop.table(table(smpp$`å•åŒ`))
barplot(prop.table(table(smpp$`å•åŒ`)))
```

ä»¥ä¸Šå›¾è¡¨æ˜¾ç¤ºéª°å­æ€»å€¼å¼€`å•`æˆ–`åŒ`çš„æ¦‚ç‡ã€‚

```{r}
table(smpp$`é±¼è™¾èŸ¹1`)
prop.table(table(smpp$`é±¼è™¾èŸ¹1`))
barplot(prop.table(table(smpp$`é±¼è™¾èŸ¹1`)))
```

ä»¥ä¸Šå›¾è¡¨æ˜¾ç¤ºéª°å­æ€»å€¼å¼€`è‘«`ã€`è™¾`ã€`èŸ¹`ã€`é’±`ã€`é±¼`æˆ–`é¸¡`çš„æ¦‚ç‡ã€‚

```{r}
table(smpp$`é±¼è™¾èŸ¹2`)
prop.table(table(smpp$`é±¼è™¾èŸ¹2`))
barplot(prop.table(table(smpp$`é±¼è™¾èŸ¹2`)))
```

ä»¥ä¸Šå›¾è¡¨æ˜¾ç¤ºéª°å­æ€»å€¼å¼€`è‘«`ã€`è™¾`ã€`èŸ¹`ã€`é’±`ã€`é±¼`æˆ–`é¸¡`çš„æ¦‚ç‡ã€‚

```{r}
table(smpp$`é±¼è™¾èŸ¹3`)
prop.table(table(smpp$`é±¼è™¾èŸ¹3`))
barplot(prop.table(table(smpp$`é±¼è™¾èŸ¹3`)))
```

ä»¥ä¸Šå›¾è¡¨æ˜¾ç¤ºéª°å­æ€»å€¼å¼€`è‘«`ã€`è™¾`ã€`èŸ¹`ã€`é’±`ã€`é±¼`æˆ–`é¸¡`çš„æ¦‚ç‡ã€‚

## ç»Ÿè®¡å»ºæ¨¡

ä»¥ä¸‹æ˜¯ä»¥å¹¿ä¹‰å‹æ³Šæ¾æ¨¡å‹é¢„æµ‹å¼€å¥–ç‡ã€‚

```{r}
### è®¡ç®—æ€»å€¼æ¦‚ç‡

## https://stats.stackexchange.com/questions/272194/interpreting-poisson-output-in-r
md1a <- glm(`æ€»å€¼`~`éª°å­1`+`éª°å­2`+`éª°å­3`, data = smpp, family = poisson)

md1b <- glm(`æ€»å€¼`~`éª°å­1`+`éª°å­2`+`éª°å­3` - 1, data = smpp, family = poisson)

ldply(
  list(md1a, md1b), AIC) %>% 
  data.frame(`æ¨¡å‹` = c('æˆªè·', 'æ²¡æˆªè·'), .) %>% 
  dplyr::rename(AIC = V1) %>% 
  dplyr::mutate(Rank = rank(AIC)) %>% 
  kable(caption = 'ç»Ÿè®¡æ¨¡å‹') %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  row_spec(0, bold = TRUE, color = '#FDD017', background = '#3A3B3C') %>% 
  row_spec(1, color = '#FFFF00', background = '#657383') %>% 
  row_spec(2, color = '#FFFF00', background = '#6D7B8D')
```

æ ¹æ®ä»¥ä¸Šæ¨¡å‹ï¼Œ`æˆªè·`æ¨¡å‹æ¯”è¾ƒç²¾å‡†ã€‚

```{r}
md1a.pp <- md1a %>% 
  coef %>% 
  exp %>% 
  llply(., function(x) {dpois(3:18, x)}) %>% 
  bind_cols %>% 
  data.frame(x = 3:18, .)

names(md1a.pp) <- c('x', 'æˆªè·', 'éª°å­1', 'éª°å­2', 'éª°å­3')
md1a.pp %>% 
  kable(caption = 'ç»Ÿè®¡æ¨¡å‹') %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  row_spec(0, bold = TRUE, color = '#FDD017', background = '#3A3B3C') %>% 
  row_spec(seq(1, nrow(md1a.pp), by = 2), color = '#FFFF00', background = '#657383') %>% 
  row_spec(seq(2, nrow(md1a.pp), by = 2), color = '#FFFF00', background = '#C0C0C0') %>% 
  scroll_box(width = '100%', height = '400px')
```

### è®¡ç®—å¤§å°æ¦‚ç‡

```{r}
md2a <- glm(as.numeric(`å¤§å°`)~`éª°å­1`+`éª°å­2`+`éª°å­3`, data = smpp, family = poisson)

md2b <- glm(as.numeric(`å¤§å°`)~`éª°å­1`+`éª°å­2`+`éª°å­3` - 1, data = smpp, family = poisson)

ldply(list(md2a, md2b), AIC) %>% 
  data.frame(`æ¨¡å‹` = c('æˆªè·', 'æ²¡æˆªè·'), .) %>% 
  dplyr::rename(AIC = V1) %>% 
  dplyr::mutate(Rank = rank(AIC)) %>% 
  kable(caption = 'ç»Ÿè®¡æ¨¡å‹') %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  row_spec(0, bold = TRUE, color = '#FDD017', background = '#3A3B3C') %>% 
  row_spec(1, color = '#FFFF00', background = '#657383') %>% 
  row_spec(2, color = '#FFFF00', background = '#6D7B8D')
```

æ ¹æ®ä»¥ä¸Šæ¨¡å‹ï¼Œ`æˆªè·`æ¨¡å‹æ¯”è¾ƒç²¾å‡†ã€‚

```{r}
md2a.pp <- md2a %>% 
  coef %>% 
  exp %>% 
  llply(., function(x) {dpois(1:18, x)}) %>% 
  bind_cols %>% 
  data.frame(x = 1:18, .)

names(md1a.pp) <- c('x', 'æˆªè·', 'éª°å­1', 'éª°å­2', 'éª°å­3')
md1a.pp %>% 
  kable(caption = 'ç»Ÿè®¡æ¨¡å‹') %>% 
  kable_styling(
  bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  row_spec(0, bold = TRUE, color = '#FDD017', background = '#3A3B3C') %>% 
  row_spec(seq(1, nrow(md1a.pp), by = 2), color = '#FFFF00', background = '#657383') %>% 
  row_spec(seq(2, nrow(md1a.pp), by = 2), color = '#FFFF00', background = '#C0C0C0') %>% 
  scroll_box(width = '100%', height = '400px')
```

### è®¡ç®—å•åŒæ¦‚ç‡

```{r}
md3a <- glm(as.numeric(`å•åŒ`)~`éª°å­1`+`éª°å­2`+`éª°å­3`, data = smpp, family = poisson)

md3b <- glm(as.numeric(`å•åŒ`)~`éª°å­1`+`éª°å­2`+`éª°å­3` - 1, data = smpp, family = poisson)

ldply(list(md3a, md3b), AIC) %>% 
  data.frame(`æ¨¡å‹` = c('æˆªè·', 'æ²¡æˆªè·'), .) %>% 
  dplyr::rename(AIC = V1) %>% 
  dplyr::mutate(Rank = rank(AIC)) %>% 
  kable(caption = 'ç»Ÿè®¡æ¨¡å‹') %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  row_spec(0, bold = TRUE, color = '#FDD017', background = '#3A3B3C') %>% 
  row_spec(1, color = '#FFFF00', background = '#657383') %>% 
  row_spec(2, color = '#FFFF00', background = '#6D7B8D')
```

æ ¹æ®ä»¥ä¸Šæ¨¡å‹ï¼Œ`æˆªè·`æ¨¡å‹æ¯”è¾ƒç²¾å‡†ã€‚

```{r}
md3a.pp <- md3a %>% 
  coef %>% 
  exp %>% 
  llply(., function(x) {dpois(1:6, x)}) %>% 
  bind_cols %>% 
  data.frame(x = 1:6, .)

names(md1a.pp) <- c('x', 'æˆªè·', 'éª°å­1', 'éª°å­2', 'éª°å­3')

md1a.pp %>% 
  kable(caption = 'ç»Ÿè®¡æ¨¡å‹') %>% 
  kable_styling(
  bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  row_spec(0, bold = TRUE, color = '#FDD017', background = '#3A3B3C') %>% 
  row_spec(seq(1, nrow(md1a.pp), by = 2), color = '#FFFF00', background = '#657383') %>% 
  row_spec(seq(2, nrow(md1a.pp), by = 2), color = '#FFFF00', background = '#C0C0C0') %>% 
  scroll_box(width = '100%', height = '400px')
```

```{r error=TRUE}
## load function files
pth <- paste0('function/bivpois/R/', list.files(path = 'function/bivpois/R/'))
l_ply(pth, source)

attr(smpp$å•åŒ,'contrasts') <- stats::contrasts(stats::C(factor(smpp$å•åŒ), sum))
attr(smpp$å¤§å°,'contrasts') <- stats::contrasts(stats::C(factor(smpp$å¤§å°), sum))
attr(smpp$å•åŒ,'levels') <- levels(factor(smpp$å•åŒ))
attr(smpp$å¤§å°,'levels') <- levels(factor(smpp$å¤§å°))

## formula for modeling of lambda1 and lambda2
#form1 <- ~c(team1,team2)+c(team2,team1)

## Model 1: Double Poisson
#ex4.m1<-lm.bp( g1~1, g2~1, l1l2=form1, zeroL3=TRUE, data=ex4.ita91)

## Models 2-5: bivariate Poisson models
#ex4.m2<-lm.bp(g1~1,g2~1, l1l2=form1, data=ex4.ita91, maxit=2)
#ex4.m3<-lm.bp(g1~1,g2~1, l1l2=form1, l3=~team1, data=ex4.ita91, maxit=2)
#ex4.m4<-lm.bp(g1~1,g2~1, l1l2=form1, l3=~team2, data=ex4.ita91, maxit=2)
#ex4.m5<-lm.bp(g1~1,g2~1, l1l2=form1, l3=~team1+team2, data=ex4.ita91, maxit=2)

form1 <- ~c('å¤§å°', 'å•åŒ') + c('å•åŒ', 'å¤§å°')
l1 = æ€»å€¼~1; l2 = æ€»å€¼~2; l1l2 = NULL; l3 = ~1; data = smppp; common.intercept = FALSE; zeroL3 = FALSE; maxit = 100; pres = 1e-8; verbose = getOption('verbose')

lm.bp(å¤§å° ~ 1, å•åŒ ~ 2, l1l2 = form1, zeroL3 = TRUE, data = smpp)
lm.bp(å¤§å° ~ 1, å•åŒ ~ 2, l1l2 = form1, data = smpp, maxit = 2)
lm.bp(å¤§å° ~ 1, å•åŒ ~ 2, l1l2 = form1, l3 = ~å•åŒ, data = smpp, maxit = 2)
lm.bp(å¤§å° ~ 1, å•åŒ ~ 2, l1l2 = form1, l3 = ~å¤§å°+å•åŒ, data = smpp, maxit = 2)
```

### è®¡ç®—å¤§å°å•åŒæ¦‚ç‡

#### 760æœŸ

```{r error=TRUE}
dx = glm(as.numeric(å¤§å°)~æ€»å€¼-1, family=poisson, data=smppp) %>% 
  coef %>% 
  exp
dx <- dx/sum(1 + dx)
ds = glm(as.numeric(å•åŒ)~æ€»å€¼-1, family=poisson, data=smppp) %>% 
  coef %>% 
  exp
ds <- ds/sum(1 + ds)
n760 <- data.frame(dx, ds) %>% 
    dplyr::rename(`å¼€å¤§` = dx, `å¼€å•` = ds) %>% 
    dplyr::mutate(`å¼€å°` = 1- `å¼€å¤§`, `å¼€åŒ` = 1- `å¼€å•`) %>% 
    dplyr::select('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ')

n760[c('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ')] %>% 
  colMeans %>% t %>% 
  kable(caption = '760æœŸä¸ºæ ‡å‡†') %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  row_spec(0, bold = TRUE, color = '#FDD017', background = '#3A3B3C') %>% 
  row_spec(1, color = '#FFFF00', background = '#657383')
```

#### 20æœŸ

```{r}
##20æœŸä¸ºæ ‡å‡†
n20 <- llply(21:nrow(smppp), function(i) {
  ii <- i - 20
  dx = glm(as.numeric(å¤§å°)~æ€»å€¼-1, family=poisson, data=smppp[c(ii:i),]) %>% 
    coef %>% 
    exp
  dx <- dx/sum(1 + dx)
  ds = glm(as.numeric(å•åŒ)~æ€»å€¼-1, family=poisson, data=smppp[c(ii:i),]) %>% 
    coef %>% 
    exp
  ds <- ds/sum(1 + ds)
  data.frame(dx, ds) %>% 
    dplyr::rename(`å¼€å¤§` = dx, `å¼€å•` = ds) %>% 
    dplyr::mutate(`å¼€å°` = 1- `å¼€å¤§`, `å¼€åŒ` = 1- `å¼€å•`) %>% 
    dplyr::select('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ') %>% 
    data.frame(smppp[i,], .)
  }) %>% 
  bind_rows %>% 
  as_tibble

n20 %>% 
  kable(caption = '20æœŸä¸ºæ ‡å‡†') %>% 
  kable_styling(
    bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  scroll_box(width = '100%', height = '400px')
```

ä»¥ä¸Šçš„æ•°æ®ä»¥`20`æœŸç§»åŠ¨æ•°æ®ä¸ºæ ‡å‡†ï¼Œç„¶åé¢„æµ‹ç¬¬`21`æœŸç§»åŠ¨æ•°æ®çš„å¼€å¥–ç‡ã€‚

```{r}
n20[c('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ')] %>% 
  colMeans %>% t %>% 
  kable(caption = '20æœŸä¸ºæ ‡å‡†') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive'))
```

ä»¥ä¸Šä¹ƒ`20`æœŸæ€»ä½“å¼€å¥–è¯¥ç‡ã€‚

#### 30æœŸ

```{r}
##30æœŸä¸ºæ ‡å‡†
n30 <- llply(31:nrow(smppp), function(i) {
  ii <- i - 30
  dx = glm(as.numeric(å¤§å°)~æ€»å€¼-1, family=poisson, data=smppp[c(ii:i),]) %>% 
    coef %>% exp
  dx <- dx/sum(1 + dx)
  ds = glm(as.numeric(å•åŒ)~æ€»å€¼-1, family=poisson, data=smppp[c(ii:i),]) %>% 
    coef %>% exp
  ds <- ds/sum(1 + ds)
  data.frame(dx, ds) %>% 
    rename(`å¼€å¤§` = dx, `å¼€å•` = ds) %>% 
    mutate(`å¼€å°` = 1- `å¼€å¤§`, `å¼€åŒ` = 1- `å¼€å•`) %>% 
    select('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ') %>% 
    data.frame(smppp[i,], .)
}) %>% bind_rows %>% as_tibble

n30 %>% 
  kable(caption = '20æœŸä¸ºæ ‡å‡†') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  scroll_box(width = '100%', height = '400px')
```

ä»¥ä¸Šçš„æ•°æ®ä»¥`30`æœŸç§»åŠ¨æ•°æ®ä¸ºæ ‡å‡†ï¼Œç„¶åé¢„æµ‹ç¬¬`31`æœŸç§»åŠ¨æ•°æ®çš„å¼€å¥–ç‡ã€‚

```{r}
n30[c('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ')] %>% 
  colMeans %>% t %>% 
  kable(caption = '30æœŸä¸ºæ ‡å‡†') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive'))
```

ä»¥ä¸Šä¹ƒ`30`æœŸæ€»ä½“å¼€å¥–è¯¥ç‡ã€‚

#### 40æœŸ

```{r}
##40æœŸä¸ºæ ‡å‡†
n40 <- llply(41:nrow(smppp), function(i) {
  ii <- i - 40
  dx = glm(as.numeric(å¤§å°)~æ€»å€¼-1, family=poisson, data=smppp[c(ii:i),]) %>% 
    coef %>% exp
  dx <- dx/sum(1 + dx)
  ds = glm(as.numeric(å•åŒ)~æ€»å€¼-1, family=poisson, data=smppp[c(ii:i),]) %>% 
    coef %>% exp
  ds <- ds/sum(1 + ds)
  data.frame(dx, ds) %>% 
    rename(`å¼€å¤§` = dx, `å¼€å•` = ds) %>% 
    mutate(`å¼€å°` = 1- `å¼€å¤§`, `å¼€åŒ` = 1- `å¼€å•`) %>% 
    select('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ') %>% 
    data.frame(smppp[i,], .)
}) %>% bind_rows %>% as_tibble

n40 %>% 
  kable(caption = '40æœŸä¸ºæ ‡å‡†') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  scroll_box(width = '100%', height = '400px')
```

ä»¥ä¸Šçš„æ•°æ®ä»¥`40`æœŸç§»åŠ¨æ•°æ®ä¸ºæ ‡å‡†ï¼Œç„¶åé¢„æµ‹ç¬¬`41`æœŸç§»åŠ¨æ•°æ®çš„å¼€å¥–ç‡ã€‚

```{r}
n40[c('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ')] %>% 
  colMeans %>% t %>% 
  kable(caption = '40æœŸä¸ºæ ‡å‡†') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive'))
```

ä»¥ä¸Šä¹ƒ`40`æœŸæ€»ä½“å¼€å¥–è¯¥ç‡ã€‚

#### 50æœŸ

```{r}
##50æœŸä¸ºæ ‡å‡†
n50 <- llply(51:nrow(smppp), function(i) {
  ii <- i - 50
  dx = glm(as.numeric(å¤§å°)~æ€»å€¼-1, family=poisson, data=smppp[c(ii:i),]) %>% 
    coef %>% exp
  dx <- dx/sum(1 + dx)
  ds = glm(as.numeric(å•åŒ)~æ€»å€¼-1, family=poisson, data=smppp[c(ii:i),]) %>% 
    coef %>% exp
  ds <- ds/sum(1 + ds)
  data.frame(dx, ds) %>% 
    rename(`å¼€å¤§` = dx, `å¼€å•` = ds) %>% 
    mutate(`å¼€å°` = 1- `å¼€å¤§`, `å¼€åŒ` = 1- `å¼€å•`) %>% 
    select('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ') %>% 
    data.frame(smppp[i,], .)
}) %>% bind_rows %>% as_tibble

n20 %>% 
  kable(caption = '50æœŸä¸ºæ ‡å‡†') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive')) %>% 
  scroll_box(width = '100%', height = '400px')
```

ä»¥ä¸Šçš„æ•°ä»¥`50`æœŸç§»åŠ¨æ•°æ®ä¸ºæ ‡å‡†ï¼Œç„¶åé¢„æµ‹ç¬¬`51`æœŸç§»åŠ¨æ•°æ®çš„å¼€å¥–ç‡ã€‚

```{r}
n50[c('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ')] %>% 
  colMeans %>% t %>% 
  kable(caption = '50æœŸä¸ºæ ‡å‡†') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive'))
```

ä»¥ä¸Šä¹ƒ`50`æœŸæ€»ä½“å¼€å¥–è¯¥ç‡ã€‚

### æ¨¡å‹æ¯”è¾ƒ

```{r}
md <- list(n760 = n760, 
     n20 = n20[c('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ')] %>% colMeans, 
     n30 = n30[c('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ')] %>% colMeans, 
     n40 = n40[c('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ')] %>% colMeans, 
     n50 = n50[c('å¼€å¤§', 'å¼€å°', 'å¼€å•', 'å¼€åŒ')] %>% colMeans) %>% bind_rows
md <- data.frame(.id = c('n760', 'n20', 'n30', 'n40', 'n50'), md) %>% as_tibble

md %>% 
  kable(caption = 'æ¨¡å‹æ¯”è¾ƒ') %>% 
  kable_styling(bootstrap_options = c('striped', 'hover', 'condensed', 'responsive'))
```

ä»¥ä¸Šçš„æ ·æœ¬æ•°æ®æ˜¾ç¤ºï¼Œ`20`æœŸã€`30`æœŸã€`40`æœŸå’Œ`50`æœŸä¸ºä¸€ä¸ªç§»åŠ¨æ•°æ®é¢„æµ‹ä¸‹ä¸€æœŸå¼€å¥–ç‡ï¼Œç»“æœéƒ½æ˜¯ç›¸å·®ä¸å¤§ã€‚

## ç›ˆåˆ©æ¨¡å¼

### å¥—å½©

**èµ”ç‡ä¸ä¼˜æƒ **

ä»¥å¹³å°æ¬§èµ”`1.98`æ¥è¯´ï¼Œäºšèµ”`0.98`ç­‰äº`r 1/0.98`ï¼Œä¼šå‘˜å¹³å‡æŠ•`r 1/0.98`å…ƒæ‰èƒ½èµ¢1å…ƒã€‚

- ä»¥å¼€å¤§æ¦‚ç‡`0.506`æ¥è¯´ï¼Œå¼€å¤§çš„ä¼˜åŠ¿ä¸º`r 0.506/0.5`ï¼Œä¼šå‘˜å°†ä¼šäº`r 0.506/0.5 - 1/0.98`ï¼Œä¸è¿‡ä»¥æˆ‘ä»¬å¹³å°çš„ä¼˜æƒ æ´»åŠ¨å½©é‡‘é€å¾—å¤šï¼Œè¿˜æ˜¯å¯ä»¥èµ¢é’±çš„å‘¢ã€‚
- ä»¥å¼€å•æ¦‚ç‡`0.508`æ¥è¯´ï¼Œå¼€å•çš„ä¼˜åŠ¿ä¸º`r 0.508/5`ï¼Œä¼šå‘˜å°†ä¼šäº`r 0.508/0.5 - 1/0.98`ï¼Œä¸è¿‡ä»¥æˆ‘ä»¬å¹³å°çš„ä¼˜æƒ æ´»åŠ¨å½©é‡‘é€å¾—å¤šï¼Œè¿˜æ˜¯å¯ä»¥èµ¢é’±çš„å‘¢ã€‚

æˆ‘ä»¬å¹³å°æœ€æ–°æ´»åŠ¨å½©é‡‘ä»‹ç»ï¼š

  1) å‘¨ä¸€åˆ°å‘¨äº”è½¬è´¦å½©é‡‘2%é€ï¼Œæ¬¡æ—¥è‡ªåŠ¨åˆ°è´¦ã€‚
  2) å‘¨å…­ï¼Œå‘¨æ—¥è½¬è´¦å½©é‡‘3%é€ï¼Œå½“å¤©æœªä¸‹æ³¨å‰æ‰¾åœ¨çº¿å®¢æœé¢†å–ã€‚
  3) æ¯æ—¥å˜‰å¥–é›¶ç‚¹åè‡ªå·±æ‰‹åŠ¨é¢†å–ï¼Œåœ¨å¹³å°çš„æ´»åŠ¨ä¸­å¿ƒæ¯æ—¥å˜‰å¥–é‡Œé¢é¢†å–ã€‚
  4) æ™‹çº§å¥–åŠ±æœ€é«˜58888 åœ¨å¹³å°æ´»åŠ¨ä¸­å¿ƒæ™‹çº§å¥–åŠ±é‡Œé¢é¢†å–ã€‚
  5) å®˜æ–¹æˆæƒèŠå¤©å®¤ç¦åˆ©æ¥è¢­  çº¢åŒ…æ¯å¤©100ä¸‡ æ•´ç‚¹å‘æ”¾é¢†å–æœ€é«˜1888ã€‚
  6) ä½™é¢å®æ´»æœŸç†è´¢ï¼Œæ¯1ä¸‡æœ¬é‡‘å­˜å…¥ä½™é¢å®è½¬å‡ºä½™é¢å¯ä»¥ç›´æ¥é¢†å–1000å½©é‡‘ã€‚
  7) ç­¾åˆ°æ»¡å‹¤å¥–ï¼Œåªè¦ä¸€æ˜ŸæœŸå†…æ»¡è¶³å­˜æ¬¾æ¡ä»¶ï¼Œæ˜ŸæœŸä¸€å³å¯é¢†å–æœ€é«˜5888å…ƒå¥–åŠ±
  
æé†’ï¼šæ¯ç¬”å……å€¼é‡‘é¢è¾¾åˆ°200å…ƒä»¥ä¸Šï¼Œæ–¹å¯é¢†å–è½¬å¡åŠ èµ å½©é‡‘ï¼ˆä¸é™ç¬”æ•°ï¼‰

ä»¥ä¸Šä¼˜æƒ ä¸èµ”ç‡å¼€å¥–æ•°æ®ï¼Œå¯ä»¥è¯æ˜æ˜¯å¯ä»¥å¥—å½©çš„å‘¢ã€‚

### æŠ•æ³¨æ¨¡å¼

**å¿…èƒœæ”»ç•¥ï¼ŒçœŸå®ç¨³èµš**
ä½ ä¸€å®šè¡Œï¼Œä½ ä¸€å®šèµ¢

#### ç§˜è¯€1ï¼šå¢å€æ–¹å¼

ä»¥10èµ·æŠ¼ä¸ºä¾‹,10,20,40,80,160,320,640ä¾æ¬¡ä¸‹å»ï¼Œåæ­£ä¸€æŠŠå°±è¦æŠŠå‰é¢è¾“çš„èµ¢å›æ¥ï¼Œå‡†å¤‡æœ€å°‘6æœŸæœ¬é‡‘ã€‚å½“ç„¶ä¹Ÿè¦è§†è‡ªå·±çš„æƒ…å†µæŠ¼ï¼Œæ¯”å¦‚5,10,20,40 èµ·æŠ¼ï¼Œå€å¢å¤šå°‘è‡ªå·±å¯ä»¥ç®—ã€‚

![](figure/å¿«ä¸‰ - å€æŠ•è¡¨.jpg)

æœ‰å…´è¶£ç´¢å–ä¸ªå€æŠ•è¡¨ç”µå­è¡¨æ ¼ï¼ŒåŠ èœèœQQï¼š2849108450

#### ç§˜è¯€2ï¼šæŠ¼æ³¨æ–¹å¼

è¿›è¡Œæ¸¸æˆåè°èµ¢å°±æŠ¼è°ã€‚å¤§èµ¢äº†ï¼Œå°±æŠ¼å¤§ã€‚ å¦‚æœå°èµ¢äº†ï¼Œé‚£å°±è·Ÿç€æŠ¼å°;ç„¶åå°±ä¸€ç›´äº¤æ›¿ç€æŠ¼ï¼Œè¿™æ ·æŠ¼çš„ç›®çš„æ˜¯é¿å…å‡º10è¿ï¼Œç”šè‡³20è¿äºã€‚

#### ç§˜è¯€3ï¼šèµ°åŠ¿è§„å¾‹

å£è¯€ä¸­çš„ä¸€è§è·³è·Ÿè·³;ä¸ç®¡ä»€ä¹ˆæ—¶å€™ç©ï¼Œæˆ‘ä»¬éƒ½è¦å­¦ä¼šè§‚å¯Ÿèµ°åŠ¿è§„å¾‹ï¼Œå³å¤§å°å¤§å°å¤§å°;è¿™æ ·å•è·³çš„æƒ…å†µï¼Œä¸€æ—¦å‡ºç°æ—¶ï¼Œæˆ‘ä»¬å°±è¦é¡ºåŠ¿è€Œä¸ºå‡ºå¤§ä¹°å°ï¼Œå‰é¢çš„æ–¹æ³•æˆ‘ä»¬éƒ½å…ˆä¸è¦ç®¡ï¼Œä¸€ç›´åˆ°ä¸å†å•è·³ä¸ºæ­¢ã€‚

![](figure/çœ‹èµ°åŠ¿.jpg)

#### ç§˜è¯€4ï¼šé›ªçƒæ–¹å¼

æ¯æ—¥æœ€å¤šå……50æ¬¡200å…ƒæœ€å¤šäº1ä¸‡å…ƒï¼Œæ¯æ¬¡2ç™¾å…ƒæ¢­å“ˆ7æ¬¡èµ¢åˆ°12800æ‰ææ¬¾ï¼Œè¿‡ä¸€ä¸ª6æ¬¡æ¢­å“ˆå°±æŠµæ¶ˆ64æ¬¡äº200å…ƒçš„æœ¬é‡‘ï¼Œä¾æ¦‚ç‡æ¥è¯´å¾ˆåˆ’ç®—ã€‚ä¸€å¤©è¯•50æ¬¡ï¼Œåªè¦è¿‡ä¸€æ¬¡å°±èƒ½èµ¢å‡ åƒå…ƒã€‚å³ä½¿ç¬¬50æ¬¡æ‰è¿‡ä¹Ÿèƒ½èµš2800å…ƒï¼Œéš¾é“è¯•50æ¬¡ï¼Œå°±è¿è¿‡ä¸€ä¸ª7æ¬¡æ¢­å“ˆéƒ½ä¸å¯èƒ½å—ï¼Ÿ

æœ€ç®€å•æœ€å®ç”¨çš„æ–¹æ³•ï¼Œéœ€è¦å¬è€å¸ˆè¯¦ç»†è®²è§£ã€‚

### çº¿ä¸‹æ´»åŠ¨

#### å¤§é¢å½©é‡‘

![](figure/ä¼˜æƒ  - æ´»åŠ¨1.jpg)

å½©é‡‘é€å¾—å¤šï¼Œåé¢æœ‰é™ï¼Œç›¸ä¿¡å…¶å®ƒå¹³å°éƒ½æ²¡æœ‰å‘¢ã€‚

#### åŒ…èµ”æ´»åŠ¨

äºå¾—å¤šçš„ä¼šå‘˜å¯ä»¥æŠ¥åé¢„çº¦å¸¦äºäº†åŒ…èµ”ï¼Œåé¢æœ‰é™ï¼Œç›¸ä¿¡å…¶å®ƒå¹³å°éƒ½æ²¡æœ‰å‘¢ã€‚

#### å¸¦èµšæ´»åŠ¨

![](figure/å•å¸¦é¢„çº¦è¡¨1.jpg)

æ— è®ºç›ˆäºçš„ä¼šå‘˜ï¼Œäºå¾—å¤šçš„ä¼šå‘˜æ›´éœ€è¦æŠ¥åé¢„çº¦èµ¢å›é’±ï¼Œåé¢æœ‰é™ï¼Œç›¸ä¿¡å…¶å®ƒå¹³å°éƒ½æ²¡æœ‰å‘¢ã€‚

### å½“ä»£ç†

![](figure/ä»£ç† - å¼€å‘ä¸‹çº§ä½£é‡‘1.jpg)

ä»¥ä¸Šå›¾è¡¨æ˜¾ç¤ºå½“ä»£ç†å¯ä»¥æŒ£é’±çš„å‘¢ã€‚æ¯”æ–¹è¯´ä»‹ç»3ä¸ªæœ‹å‹å½“ä¸‹çº§ï¼Œè¿”ç‚¹è®¾ç½®ä¸º`8.5`çš„è¯ï¼Œå„åˆ«å……5åƒæ‰“1ä¸‡5åƒæ‰“ç é‡çš„è¯ï¼Œå°±æœ‰4ä¸‡5åƒæ‰“ç é‡ï¼Œ3äºº x 4.5æ‰“ç é‡ x 50è¿”ç‚¹ = `r 3*4.5*50`ã€‚å‡å¦‚1å¤©æŒ£`r 3*4.5*50`ï¼Œä¸€ä¸ªæœˆå°±èƒ½æŒ£`r 3*4.5*50*30`äº†ã€‚

![](figure/ä»£ç† - å¼€å‘ä¸‹çº§æ­¥éª¤.jpg)

ä»¥ä¸Šä¹ƒæ¿€æ´»é‚€è¯·ç çš„æ•™ç¨‹ã€‚

å½“ä»£ç†æŒ£è¿”ç‚¹ä¹Ÿæ˜¯é€‚åˆæ‰“å·¥ä¸€æ—ä¸šä½™å…¼èŒã€å®å¦ˆã€å­¦ç”Ÿï¼Œå°¤å…¶æ˜¯ç”Ÿæ„äººäººè„‰å¹¿é˜”ï¼ŒæŒ£é’±æ–¹ä¾¿ç”Ÿæ„å‘¨è½¬ã€‚

# ç»“è®º

## æ€»ç»“

ä»¥ä¸Šæ€»ç»“ï¼Œä¼šå‘˜å¯ä»¥åˆ°æˆ‘ä»¬å¹³å°é€šè¿‡ä¸åŒç›ˆåˆ©æ¨¡å¼æŒ£é’±çš„å‘¢ã€‚

```{r eval=FALSE}

## æ”¹è¿›

## https://stackoverflow.com/a/45344291
require('RSelenium')
require('rvest')
#require('wdman')
#require('webshot')
require('decryptr')

## ç½‘å€
## ç™»å½•ç½‘å€
lnk <- 'https://m.a80802.com:8760/login'
## å½©ç§ä¸€æ 
lnkcz <- 'https://m.cjezllpcecbm.com/allLottery/?source=lottery'
## 1åˆ†å¿«ä¸‰
lnk1k3 <- 'https://m.cjezllpcecbm.com/history/K3/OG1K3/?source=lottery'
## 3åˆ†å¿«ä¸‰
lnk3k3 <- 'https://m.cjezllpcecbm.com/history/K3/OG3K3/?source=lottery'

#lnk1k3 %>% 
#  read_html %>% 
#  html_nodes(xpath = '//*[@id="scrollContainer"]/div[2]') %>% 
#  html_table()

## æ‰“å¼€éšè—æµè§ˆå™¨
pDrv <- phantomjs(port = 4567L, check = FALSE, verbose = FALSE)
remDr <- remoteDriver(browserName = 'phantomjs', port = 4567L)
remDr$open(silent = TRUE)

## æµè§ˆç½‘ç«™
remDr$navigate(lnk1k3)

## è¾“å…¥è´¦å·
webElem <- remDr$findElement(using = 'xpath', value = '//*[@id="app"]/div/div[1]/div[3]/div/table/tbody/tr[1]/td[2]/input')
webElem$clickElement()
webElem$sendKeysToElement(list('leiou004', key = 'enter'))

## è¾“å…¥å¯†ç 
webElem <- remDr$findElement(using = 'xpath', value = '//*[@id="app"]/div/div[1]/div[3]/div/table/tbody/tr[2]/td[2]/input')
webElem$clickElement()
webElem$sendKeysToElement(list('leiou123', key = 'enter'))

## éªŒè¯ç 
## https://github.com/decryptr/decryptr
## https://rpubs.com/johndharrison/14707
webElem <- remDr$findElement(using = 'xpath', value = '//*[@id="geetest"]/div/div[2]/div[1]/div[3]')
webElem$clickElement()
webElem$sendKeysToElement(list(key = 'enter'))
#webElem$switchToFrame('div.geetest_popup_box')

#if (!require(devtools)) install.packages('devtools')
#devtools::install_github('decryptr/decryptr')





##æ ·æœ¬æ•°æ®åªæ˜¯å‡ä½æŠ•èµ„é£é™©ï¼Œé‡‡é›†å®æ—¶æ•°æ®æ‰èƒ½è¯å®æœ‰æ•ˆæ€§ã€‚


```

## é™„å½•

```{r info}
#suppressMessages(require('formattable', quietly = TRUE))
#suppressMessages(require('knitr', quietly = TRUE))
#suppressMessages(require('kableExtra', quietly = TRUE))
#suppressMessages(require('magittr', quietly = TRUE))
#suppressMessages(require('devtools', quietly = TRUE))

sys1 <- session_info()$platform |> 
    unlist() |> 
    {\(.) data.frame(row.names = 1:length(.), 
                     Category = names(.), session_info = .)}()

sys2 <- data.frame(Sys.info()) |> 
    {\(.) data.frame(Category = row.names(.), Sys.info = .[,1])}()

#remarks, dim(sys1), dim(sys2)
if (nrow(sys1) == 11 && nrow(sys2) == 8) {
  sys2 <- sys2 |> 
    {\(.) rbind(., data.frame(
    Category = c('rmarkdown', 'rsconnect', 'Current time'), 
    Sys.info = c(as.character(getwd()), 
                 as.character(packageVersion('rsconnect')), 
                 paste(as.character(lubridate::now('Asia/Shanghai')), 'CST ğŸ—º'))))}()
  
} else if (nrow(sys1) == 10 && nrow(sys2) == 8) {
  sys1 <- rbind(sys1, data.frame(Category = '', session_info = ''))
  
  sys2 <- sys2 |> 
    {\(.) rbind(., data.frame(
    Category = c('rmarkdown', 'rsconnect', 'Current time'), 
    Sys.info = c(as.character(getwd()), 
                 as.character(packageVersion('rsconnect')), 
                 paste(as.character(lubridate::now('Asia/Shanghai')), 'CST ğŸ—º'))))}()
}

sys <- cbind(sys1, sys2) |> 
  {\(.) 
    kbl(., caption = 'Additional session information:')}() |> 
  {\(.) 
    kable_styling(., bootstrap_options = c('striped', 'hover', 'condensed', 'responsive'))}() |> 
  {\(.) 
    row_spec(., 0, background = 'DimGrey', color = 'yellow')}() |> 
  {\(.) 
    column_spec(., 1, background = 'CornflowerBlue', color = 'red')}() |> 
  {\(.) 
    column_spec(., 2, background = 'grey', color = 'black')}() |> 
  {\(.) 
    column_spec(., 3, background = 'CornflowerBlue', color = 'blue')}() |> 
  {\(.) 
    column_spec(., 4, background = 'grey', color = 'white')}() |> 
  {\(.) 
    row_spec(., 11, bold = TRUE, color = 'yellow', background = '#D7261E')}()

rm(sys1, sys2)
sys
```

---

[<img src="figure/Scibrokes.png" width="14"/> SÏ‚Î¹Î²rÎ¿ÎºÎµrs TrÎ±dÎ¹Î·gÂ®](http://www.scibrokes.com)<br>
<span style='color:RoyalBlue'>**[<img src="figure/Scibrokes.png" width="14"/> ä¸–åšé‡åŒ–Â®](http://www.scibrokes.com)ä¼ä¸šçŸ¥è¯†äº§æƒåŠç‰ˆæƒæ‰€æœ‰ï¼Œç›—ç‰ˆå¿…ç©¶ã€‚**</span>
